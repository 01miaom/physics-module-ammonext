var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.owns=function(d,c){return Object.prototype.hasOwnProperty.call(d,c)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,c,q){d!=Array.prototype&&d!=Object.prototype&&(d[c]=q.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,c,q,F){if(c){q=$jscomp.global;d=d.split(".");for(F=0;F<d.length-1;F++){var k=d[F];k in q||(q[k]={});q=q[k]}d=d[d.length-1];F=q[d];c=c(F);c!=F&&null!=c&&$jscomp.defineProperty(q,d,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Object.assign",function(d){return d?d:function(c,d){for(var q=1;q<arguments.length;q++){var k=arguments[q];if(k)for(var n in k)$jscomp.owns(k,n)&&(c[n]=k[n])}return c}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var d=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+d++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var c=0;return $jscomp.iteratorPrototype(function(){return c<d.length?{done:!1,value:d[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.polyfill("Array.from",function(d){return d?d:function(c,d,F){$jscomp.initSymbolIterator();d=null!=d?d:function(c){return c};var k=[],n=c[Symbol.iterator];if("function"==typeof n)for(c=n.call(c);!(n=c.next()).done;)k.push(d.call(F,n.value));else{n=c.length;for(var C=0;C<n;C++)k.push(d.call(F,c[C]))}return k}},"es6","es3");
$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();var c=d[Symbol.iterator];return c?c.call(d):$jscomp.arrayIterator(d)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function c(){this.batch_=null}function q(c){return c instanceof k?c:new k(function(d,C){d(c)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;c.prototype.asyncExecute=function(c){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(c);return this};c.prototype.asyncExecuteBatch_=function(){var c=this;this.asyncExecuteFunction(function(){c.executeBatch_()})};var F=$jscomp.global.setTimeout;c.prototype.asyncExecuteFunction=function(c){F(c,
0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=this.batch_;this.batch_=[];for(var d=0;d<c.length;++d){var k=c[d];delete c[d];try{k()}catch(u){this.asyncThrow_(u)}}}this.batch_=null};c.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var k=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var d=this.createResolveAndReject_();try{c(d.resolve,d.reject)}catch(w){d.reject(w)}};k.prototype.createResolveAndReject_=
function(){function c(c){return function(C){k||(k=!0,c.call(d,C))}}var d=this,k=!1;return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};k.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof k)this.settleSameAsPromise_(c);else{a:switch(typeof c){case "object":var d=null!=c;break a;case "function":d=!0;break a;default:d=!1}d?this.resolveToNonPromiseObj_(c):this.fulfill_(c)}};k.prototype.resolveToNonPromiseObj_=function(c){var d=
void 0;try{d=c.then}catch(w){this.reject_(w);return}"function"==typeof d?this.settleSameAsThenable_(d,c):this.fulfill_(c)};k.prototype.reject_=function(c){this.settle_(2,c)};k.prototype.fulfill_=function(c){this.settle_(1,c)};k.prototype.settle_=function(c,d){if(0!=this.state_)throw Error("Cannot settle("+c+", "+d|"): Promise already settled in state"+this.state_);this.state_=c;this.result_=d;this.executeOnSettledCallbacks_()};k.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var c=
this.onSettledCallbacks_,d=0;d<c.length;++d)c[d].call(),c[d]=null;this.onSettledCallbacks_=null}};var n=new c;k.prototype.settleSameAsPromise_=function(c){var d=this.createResolveAndReject_();c.callWhenSettled_(d.resolve,d.reject)};k.prototype.settleSameAsThenable_=function(c,d){var k=this.createResolveAndReject_();try{c.call(d,k.resolve,k.reject)}catch(u){k.reject(u)}};k.prototype.then=function(c,d){function w(c,d){return"function"==typeof c?function(d){try{u(c(d))}catch(y){C(y)}}:d}var u,C,n=new k(function(c,
d){u=c;C=d});this.callWhenSettled_(w(c,u),w(d,C));return n};k.prototype.catch=function(c){return this.then(void 0,c)};k.prototype.callWhenSettled_=function(c,d){function k(){switch(u.state_){case 1:c(u.result_);break;case 2:d(u.result_);break;default:throw Error("Unexpected state: "+u.state_);}}var u=this;null==this.onSettledCallbacks_?n.asyncExecute(k):this.onSettledCallbacks_.push(function(){n.asyncExecute(k)})};k.resolve=q;k.reject=function(c){return new k(function(d,k){k(c)})};k.race=function(c){return new k(function(d,
k){for(var u=$jscomp.makeIterator(c),n=u.next();!n.done;n=u.next())q(n.value).callWhenSettled_(d,k)})};k.all=function(c){var d=$jscomp.makeIterator(c),n=d.next();return n.done?q([]):new k(function(c,k){function u(d){return function(k){C[d]=k;w--;0==w&&c(C)}}var C=[],w=0;do C.push(void 0),w++,q(n.value).callWhenSettled_(u(C.length-1),k),n=d.next();while(!n.done)})};return k},"es6","es3");
(function(d,c){"object"===typeof exports&&"undefined"!==typeof module?c(exports,require("three"),require("whs")):"function"===typeof define&&define.amd?define(["exports","three","whs"],c):c(d.PHYSICS=d.PHYSICS||{},d.THREE,d.WHS)})(this,function(d,c,q){function F(c){try{return Z.createObjectURL(new Blob([c],{type:"application/javascript"}))}catch(b){var l=new qa;l.append(c);return Z.createObjectURL(l.getBlob(type))}}function k(c){for(var l in fa)Object.defineProperty(c,l,{get:fa[l].get.bind(c),set:fa[l].set.bind(c),
configurable:!0,enumerable:!0})}function n(c){k(this);this._physijs=U({},c._physijs);this.position=this.position.clone();this.rotation=this.rotation.clone();this.quaternion=this.quaternion.clone()}function C(){this.position=this.position.clone();this.rotation=this.rotation.clone();this.quaternion=this.quaternion.clone()}function pa(d,l,b){var a=this,f=.25;l.setAngularFactor({x:0,y:0,z:0});d.position.set(0,0,0);var m=new c.Object3D;m.add(d.native);var z=new c.Object3D;z.position.y=b.ypos;z.add(m);
var h=new c.Quaternion,K=!1,k=!1,B=!1,u=!1,x=!1;l.on("collision",function(a,b,f,m){.5>m.y&&(K=!0)});document.body.addEventListener("mousemove",function(b){if(!1!==a.enabled){var f="number"===typeof b.movementX?b.movementX:"number"===typeof b.mozMovementX?b.mozMovementX:"function"===typeof b.getMovementX?b.getMovementX():0;b="number"===typeof b.movementY?b.movementY:"number"===typeof b.mozMovementY?b.mozMovementY:"function"===typeof b.getMovementY?b.getMovementY():0;z.rotation.y-=.002*f;m.rotation.x-=
.002*b;m.rotation.x=Math.max(-ia,Math.min(ia,m.rotation.x))}},!1);document.body.addEventListener("keydown",function(a){switch(a.keyCode){case 38:case 87:k=!0;break;case 37:case 65:u=!0;break;case 40:case 83:B=!0;break;case 39:case 68:x=!0;break;case 32:!0===K&&l.applyCentralImpulse({x:0,y:300,z:0});K=!1;break;case 16:f=.5}},!1);document.body.addEventListener("keyup",function(a){switch(a.keyCode){case 38:case 87:k=!1;break;case 37:case 65:u=!1;break;case 40:case 83:B=!1;break;case 39:case 68:x=!1;
break;case 16:f=.25}},!1);this.enabled=!1;this.getObject=function(){return z};this.getDirection=function(a){a.set(0,0,-1);h.multiplyVector3(a)};var T=new c.Vector3,n=new c.Euler;this.update=function(c){!1!==a.enabled&&(c=c||.5,c=Math.min(c,.5,c),T.set(0,0,0),c=1*c*b.speed*f,k&&(T.z=-c),B&&(T.z=c),u&&(T.x=-c),x&&(T.x=c),n.x=m.rotation.x,n.y=z.rotation.y,n.order="XYZ",h.setFromEuler(n),T.applyQuaternion(h),l.applyCentralImpulse({x:T.x,y:0,z:T.z}),l.setAngularVelocity({x:T.z,y:0,z:-T.x}),l.setAngularFactor({x:0,
y:0,z:0}))};l.on("physics:added",function(){l.manager.get("module:world").addEventListener("update",function(){!1!==a.enabled&&z.position.copy(l.position)})})}var w={WORLDREPORT:0,COLLISIONREPORT:1,VEHICLEREPORT:2,CONSTRAINTREPORT:3,SOFTREPORT:4},u=new c.Vector3,ea=new c.Vector3,Q=new c.Matrix4,V=new c.Quaternion,J=function(c,l){Q.identity();Q.identity().makeRotationFromQuaternion(l.quaternion);Q.getInverse(Q);u.copy(c);ea.copy(l.position);return u.sub(ea).applyMatrix4(Q)},ha=function a(c,b){for(var f=
0;f<b.children.length;f++){var m=b.children[f],l=m.component.use("physics");l&&(l=l.data,m.updateMatrix(),m.updateMatrixWorld(),u.setFromMatrixPosition(m.matrixWorld),V.setFromRotationMatrix(m.matrixWorld),l.position_offset={x:u.x,y:u.y,z:u.z},l.rotation={x:V.x,y:V.y,z:V.z,w:V.w},c.component.use("physics").data.children.push(l));a(c,m)}},y=function(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function");},G=function(){function c(b,a){for(var f=0;f<a.length;f++){var c=a[f];
c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(b,c.key,c)}}return function(b,a,f){a&&c(b.prototype,a);f&&c(b,f);return b}}(),U=Object.assign||function(c){for(var b=1;b<arguments.length;b++){var a=arguments[b],f;for(f in a)Object.prototype.hasOwnProperty.call(a,f)&&(c[f]=a[f])}return c},O=function(c,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);c.prototype=Object.create(b&&
b.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(c,b):c.__proto__=b)},R=function(c,b){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?c:b},ja=function(c){if(Array.isArray(c)){for(var b=0,a=Array(c.length);b<c.length;b++)a[b]=c[b];return a}return Array.from(c)},ka=function(){function c(){y(this,c);this._eventListeners={}}G(c,
[{key:"addEventListener",value:function(b,a){this._eventListeners.hasOwnProperty(b)||(this._eventListeners[b]=[]);this._eventListeners[b].push(a)}},{key:"removeEventListener",value:function(b,a){return this._eventListeners.hasOwnProperty(b)?0<=(a=this._eventListeners[b].indexOf(a))?(this._eventListeners[b].splice(a,1),!0):!1:!1}},{key:"dispatchEvent",value:function(b){var a,f=Array.prototype.splice.call(arguments,1);if(this._eventListeners.hasOwnProperty(b))for(a=0;a<this._eventListeners[b].length;a++)this._eventListeners[b][a].apply(this,
f)}}],[{key:"make",value:function(b){b.prototype.addEventListener=c.prototype.addEventListener;b.prototype.removeEventListener=c.prototype.removeEventListener;b.prototype.dispatchEvent=c.prototype.dispatchEvent}}]);return c}(),ra=function(){function c(b,a,f){y(this,c);void 0===f&&console.error("Both objects must be defined in a ConeTwistConstraint.");this.type="conetwist";this.appliedImpulse=0;this.worldModule=null;this.objecta=b._physijs.id;this.positiona=J(f,b).clone();this.objectb=b._physijs.id;
this.positionb=J(f,b).clone();this.axisa={x:b.rotation.x,y:b.rotation.y,z:b.rotation.z};this.axisb={x:b.rotation.x,y:b.rotation.y,z:b.rotation.z}}G(c,[{key:"getDefinition",value:function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}}},{key:"setLimit",value:function(b,a,f){this.worldModule&&this.worldModule.execute("conetwist_setLimit",{constraint:this.id,x:b,y:a,z:f})}},{key:"enableMotor",
value:function(){this.worldModule&&this.worldModule.execute("conetwist_enableMotor",{constraint:this.id})}},{key:"setMaxMotorImpulse",value:function(b){this.worldModule&&this.worldModule.execute("conetwist_setMaxMotorImpulse",{constraint:this.id,max_impulse:b})}},{key:"setMotorTarget",value:function(b){b instanceof THREE.Vector3?b=(new THREE.Quaternion).setFromEuler(new THREE.Euler(b.x,b.y,b.z)):b instanceof THREE.Euler?b=(new THREE.Quaternion).setFromEuler(b):b instanceof THREE.Matrix4&&(b=(new THREE.Quaternion).setFromRotationMatrix(b));
this.worldModule&&this.worldModule.execute("conetwist_setMotorTarget",{constraint:this.id,x:b.x,y:b.y,z:b.z,w:b.w})}}]);return c}(),sa=function(){function c(b,a,f,m){y(this,c);void 0===m&&(m=f,f=a,a=void 0);this.type="hinge";this.appliedImpulse=0;this.worldModule=null;this.objecta=b._physijs.id;this.positiona=J(f,b).clone();this.position=f.clone();this.axis=m;a&&(this.objectb=a._physijs.id,this.positionb=J(f,a).clone())}G(c,[{key:"getDefinition",value:function(){return{type:this.type,id:this.id,objecta:this.objecta,
objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}}},{key:"setLimits",value:function(b,a,f,c){this.worldModule&&this.worldModule.execute("hinge_setLimits",{constraint:this.id,low:b,high:a,bias_factor:f,relaxation_factor:c})}},{key:"enableAngularMotor",value:function(b,a){this.worldModule&&this.worldModule.execute("hinge_enableAngularMotor",{constraint:this.id,velocity:b,acceleration:a})}},{key:"disableMotor",value:function(){this.worldModule&&this.worldModule.execute("hinge_disableMotor",
{constraint:this.id})}}]);return c}(),ta=function(){function c(b,a,f){y(this,c);void 0===f&&(f=a,a=void 0);this.type="point";this.appliedImpulse=0;this.objecta=b._physijs.id;this.positiona=J(f,b).clone();a&&(this.objectb=a._physijs.id,this.positionb=J(f,a).clone())}G(c,[{key:"getDefinition",value:function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb}}}]);return c}(),ua=function(){function c(b,a,f,m){y(this,c);void 0===
m&&(m=f,f=a,a=void 0);this.type="slider";this.appliedImpulse=0;this.worldModule=null;this.objecta=b._physijs.id;this.positiona=J(f,b).clone();this.axis=m;a&&(this.objectb=a._physijs.id,this.positionb=J(f,a).clone())}G(c,[{key:"getDefinition",value:function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}}},{key:"setLimits",value:function(b,a,f,c){this.worldModule&&this.worldModule.execute("slider_setLimits",
{constraint:this.id,lin_lower:b,lin_upper:a,ang_lower:f,ang_upper:c})}},{key:"setRestitution",value:function(b,a){this.worldModule&&this.worldModule.execute("slider_setRestitution",{constraint:this.id,linear:b,angular:a})}},{key:"enableLinearMotor",value:function(b,a){this.worldModule&&this.worldModule.execute("slider_enableLinearMotor",{constraint:this.id,velocity:b,acceleration:a})}},{key:"disableLinearMotor",value:function(){this.worldModule&&this.worldModule.execute("slider_disableLinearMotor",
{constraint:this.id})}},{key:"enableAngularMotor",value:function(b,a){this.scene.execute("slider_enableAngularMotor",{constraint:this.id,velocity:b,acceleration:a})}},{key:"disableAngularMotor",value:function(){this.worldModule&&this.worldModule.execute("slider_disableAngularMotor",{constraint:this.id})}}]);return c}(),va=function(){function c(b,a,f){y(this,c);void 0===f&&(f=a,a=void 0);this.type="dof";this.appliedImpulse=0;this.worldModule=null;this.objecta=b._physijs.id;this.positiona=J(f,b).clone();
this.axisa={x:b.rotation.x,y:b.rotation.y,z:b.rotation.z};a&&(this.objectb=a._physijs.id,this.positionb=J(f,a).clone(),this.axisb={x:a.rotation.x,y:a.rotation.y,z:a.rotation.z})}G(c,[{key:"getDefinition",value:function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}}},{key:"setLinearLowerLimit",value:function(b){this.worldModule&&this.worldModule.execute("dof_setLinearLowerLimit",{constraint:this.id,
x:b.x,y:b.y,z:b.z})}},{key:"setLinearUpperLimit",value:function(b){this.worldModule&&this.worldModule.execute("dof_setLinearUpperLimit",{constraint:this.id,x:b.x,y:b.y,z:b.z})}},{key:"setAngularLowerLimit",value:function(b){this.worldModule&&this.worldModule.execute("dof_setAngularLowerLimit",{constraint:this.id,x:b.x,y:b.y,z:b.z})}},{key:"setAngularUpperLimit",value:function(b){this.worldModule&&this.worldModule.execute("dof_setAngularUpperLimit",{constraint:this.id,x:b.x,y:b.y,z:b.z})}},{key:"enableAngularMotor",
value:function(b){this.worldModule&&this.worldModule.execute("dof_enableAngularMotor",{constraint:this.id,which:b})}},{key:"configureAngularMotor",value:function(b,a,f,c,d){this.worldModule&&this.worldModule.execute("dof_configureAngularMotor",{constraint:this.id,which:b,low_angle:a,high_angle:f,velocity:c,max_force:d})}},{key:"disableAngularMotor",value:function(b){this.worldModule&&this.worldModule.execute("dof_disableAngularMotor",{constraint:this.id,which:b})}}]);return c}(),la=function(){function d(b){var a=
1<arguments.length&&void 0!==arguments[1]?arguments[1]:new VehicleTuning;y(this,d);this.mesh=b;this.wheels=[];this._physijs={id:getObjectId(),rigidBody:b._physijs.id,suspension_stiffness:a.suspension_stiffness,suspension_compression:a.suspension_compression,suspension_damping:a.suspension_damping,max_suspension_travel:a.max_suspension_travel,friction_slip:a.friction_slip,max_suspension_force:a.max_suspension_force}}G(d,[{key:"addWheel",value:function(b,a,f,m,d,h,l,k,B){b=new c.Mesh(b,a);b.castShadow=
b.receiveShadow=!0;b.position.copy(m).multiplyScalar(h/100).add(f);this.world.add(b);this.wheels.push(b);this.world.execute("addWheel",{id:this._physijs.id,connection_point:{x:f.x,y:f.y,z:f.z},wheel_direction:{x:m.x,y:m.y,z:m.z},wheel_axle:{x:d.x,y:d.y,z:d.z},suspension_rest_length:h,wheel_radius:l,is_front_wheel:k,tuning:B})}},{key:"setSteering",value:function(b,a){if(void 0!==a&&void 0!==this.wheels[a])this.world.execute("setSteering",{id:this._physijs.id,wheel:a,steering:b});else if(0<this.wheels.length)for(a=
0;a<this.wheels.length;a++)this.world.execute("setSteering",{id:this._physijs.id,wheel:a,steering:b})}},{key:"setBrake",value:function(b,a){if(void 0!==a&&void 0!==this.wheels[a])this.world.execute("setBrake",{id:this._physijs.id,wheel:a,brake:b});else if(0<this.wheels.length)for(a=0;a<this.wheels.length;a++)this.world.execute("setBrake",{id:this._physijs.id,wheel:a,brake:b})}},{key:"applyEngineForce",value:function(b,a){if(void 0!==a&&void 0!==this.wheels[a])this.world.execute("applyEngineForce",
{id:this._physijs.id,wheel:a,force:b});else if(0<this.wheels.length)for(a=0;a<this.wheels.length;a++)this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:a,force:b})}}]);return d}(),ma="undefined"===typeof Symbol?"__target":Symbol(),qa=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Z=window.URL||window.webkitURL,X=window.Worker;if(X){var aa=F("self.onmessage = function () {}"),ba=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");
var Y=new X(aa);Y.postMessage(ba,[ba.buffer])}catch(l){X=null}finally{Z.revokeObjectURL(aa),Y&&Y.terminate()}}var wa=new function(c,b){return function(a){var f=this;if(b){if(X&&!a)return a=b.toString().replace(/^function.+?{/,"").slice(0,-1),a=F(a),this[ma]=new X(a),Z.revokeObjectURL(a),this[ma];var m={postMessage:function(a){f.onmessage&&setTimeout(function(){f.onmessage({data:a,target:m})})}};b.call(m);this.postMessage=function(a){setTimeout(function(){m.onmessage({data:a,target:f})})};this.isThisThread=
!0}else return new X(c)}}("../worker.js",function(c,b){var a=this,f=a.webkitPostMessage||a.postMessage,m=void 0,d=void 0,h=void 0,l=!1,k=0,B=0,n=0,x=0,u=0,y=0,C=void 0,L=void 0,g=void 0,t=void 0,q=void 0,v=void 0,p={},r=[],w=[],E=[],G={},F={},N={},J={},Q={},D=void 0,H=void 0,A=void 0,P=void 0,I=void 0,M=void 0;c=new ArrayBuffer(1);f(c,[c]);var S=0===c.byteLength,O=function(e){return void 0!==F[e]?F[e]:null},R=function(e){h.setIdentity();switch(e.type){case "compound":var a=new Ammo.btCompoundShape;
break;case "plane":var b="plane_"+e.normal.x+"_"+e.normal.y+"_"+e.normal.z;null===(a=O(b))&&(g.setX(e.normal.x),g.setY(e.normal.y),g.setZ(e.normal.z),a=new Ammo.btStaticPlaneShape(g,0),F[b]=a);break;case "box":b="box_"+e.width+"_"+e.height+"_"+e.depth;null===(a=O(b))&&(g.setX(e.width/2),g.setY(e.height/2),g.setZ(e.depth/2),a=new Ammo.btBoxShape(g),F[b]=a);break;case "sphere":b="sphere_"+e.radius;null===(a=O(b))&&(a=new Ammo.btSphereShape(e.radius),F[b]=a);break;case "cylinder":b="cylinder_"+e.width+
"_"+e.height+"_"+e.depth;null===(a=O(b))&&(g.setX(e.width/2),g.setY(e.height/2),g.setZ(e.depth/2),a=new Ammo.btCylinderShape(g),F[b]=a);break;case "capsule":b="capsule_"+e.radius+"_"+e.height;null===(a=O(b))&&(a=new Ammo.btCapsuleShape(e.radius,e.height-2*e.radius),F[b]=a);break;case "cone":b="cone_"+e.radius+"_"+e.height;null===(a=O(b))&&(a=new Ammo.btConeShape(e.radius,e.height),F[b]=a);break;case "concave":a=new Ammo.btTriangleMesh;if(!e.data.length)return!1;b=e.data;for(var f=0;f<b.length/9;f++)g.setX(b[9*
f]),g.setY(b[9*f+1]),g.setZ(b[9*f+2]),t.setX(b[9*f+3]),t.setY(b[9*f+4]),t.setZ(b[9*f+5]),q.setX(b[9*f+6]),q.setY(b[9*f+7]),q.setZ(b[9*f+8]),a.addTriangle(g,t,q,!1);a=new Ammo.btBvhTriangleMeshShape(a,!0,!0);J[e.id]=a;break;case "convex":a=new Ammo.btConvexHullShape;b=e.data;for(f=0;f<b.length/3;f++)g.setX(b[3*f]),g.setY(b[3*f+1]),g.setZ(b[3*f+2]),a.addPoint(g);J[e.id]=a;break;case "heightfield":a=e.xpts;b=e.ypts;f=e.points;for(var c=Ammo._malloc(4*a*b),m=0,d=0,l=0;m<a;m++)for(var z=0;z<b;z++)Ammo.HEAPF32[c+
l>>2]=f[d],d++,l+=4;a=new Ammo.btHeightfieldTerrainShape(e.xpts,e.ypts,c,1,-e.absMaxHeight,e.absMaxHeight,1,"PHY_FLOAT",!1);J[e.id]=a;break;default:return}return a};p.init=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.wasmBuffer?(importScripts(e.ammo),a.Ammo=loadAmmoFromBinary(e.wasmBuffer)):importScripts(e.ammo);f({cmd:"ammoLoaded"});p.makeWorld(e)};p.makeWorld=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};h=new Ammo.btTransform;new Ammo.btTransform;
g=new Ammo.btVector3(0,0,0);t=new Ammo.btVector3(0,0,0);q=new Ammo.btVector3(0,0,0);v=new Ammo.btQuaternion(0,0,0,0);D=e.reportsize||50;S?(H=new Float32Array(2+14*D),P=new Float32Array(2+5*D),I=new Float32Array(2+9*D),M=new Float32Array(2+6*D)):(H=[],P=[],I=[],M=[]);H[0]=0;P[0]=1;I[0]=2;M[0]=3;var a=e.softbody?new Ammo.btSoftBodyRigidBodyCollisionConfiguration:new Ammo.btDefaultCollisionConfiguration,b=new Ammo.btCollisionDispatcher(a),c=new Ammo.btSequentialImpulseConstraintSolver;e.broadphase||
(e.broadphase={type:"dynamic"});switch(e.broadphase.type){case "sweepprune":g.setX(e.broadphase.aabbmin.x);g.setY(e.broadphase.aabbmin.y);g.setZ(e.broadphase.aabbmin.z);t.setX(e.broadphase.aabbmax.x);t.setY(e.broadphase.aabbmax.y);t.setZ(e.broadphase.aabbmax.z);var m=new Ammo.btAxisSweep3(g,t);break;default:m=new Ammo.btDbvtBroadphase}L=e.softbody?new Ammo.btSoftRigidDynamicsWorld(b,m,c,a,new Ammo.btDefaultSoftBodySolver):new Ammo.btDiscreteDynamicsWorld(b,m,c,a);C=e.fixedTimeStep;e.softbody&&(l=
!0);f({cmd:"worldReady"})};p.setFixedTimeStep=function(e){C=e};p.setGravity=function(e){g.setX(e.x);g.setY(e.y);g.setZ(e.z);L.setGravity(g)};p.appendAnchor=function(e){console.log(r[e.obj]);r[e.obj].appendAnchor(e.node,r[e.obj2],e.collisionBetweenLinkedBodies,e.influence)};p.addObject=function(e){var a=void 0;if(-1!==e.type.indexOf("soft")){a:{var b=new Ammo.btSoftBodyHelpers;switch(e.type){case "softTrimesh":if(!e.aVertices.length){b=!1;break a}b=b.CreateFromTriMesh(L.getWorldInfo(),e.aVertices,
e.aIndices,e.aIndices.length/3,!1);break;case "softClothMesh":var c=e.corners;b=b.CreatePatch(L.getWorldInfo(),new Ammo.btVector3(c[0],c[1],c[2]),new Ammo.btVector3(c[3],c[4],c[5]),new Ammo.btVector3(c[6],c[7],c[8]),new Ammo.btVector3(c[9],c[10],c[11]),e.segments[0],e.segments[1],0,!0);break;case "softRopeMesh":c=e.data;b=b.CreateRope(L.getWorldInfo(),new Ammo.btVector3(c[0],c[1],c[2]),new Ammo.btVector3(c[3],c[4],c[5]),c[6]-1,0);break;default:b=void 0}}c=b.get_m_cfg();e.viterations&&c.set_viterations(e.viterations);
e.piterations&&c.set_piterations(e.piterations);e.diterations&&c.set_diterations(e.diterations);e.citerations&&c.set_citerations(e.citerations);c.set_collisions(17);c.set_kDF(e.friction);c.set_kDP(e.damping);e.pressure&&c.set_kPR(e.pressure);e.drag&&c.set_kDG(e.drag);e.lift&&c.set_kLF(e.lift);e.anchorHardness&&c.set_kAHR(e.anchorHardness);e.rigidHardness&&c.set_kCHR(e.rigidHardness);e.klst&&b.get_m_materials().at(0).set_m_kLST(e.klst);e.kast&&b.get_m_materials().at(0).set_m_kAST(e.kast);e.kvst&&b.get_m_materials().at(0).set_m_kVST(e.kvst);
Ammo.castObject(b,Ammo.btCollisionObject).getCollisionShape().setMargin(e.margin?e.margin:.1);b.setActivationState(e.state||4);b.type=0;"softRopeMesh"===e.type&&(b.rope=!0);"softClothMesh"===e.type&&(b.cloth=!0);h.setIdentity();g.setX(e.position.x);g.setY(e.position.y);g.setZ(e.position.z);h.setOrigin(g);v.setX(e.rotation.x);v.setY(e.rotation.y);v.setZ(e.rotation.z);v.setW(e.rotation.w);h.setRotation(v);b.transform(h);g.setX(e.scale.x);g.setY(e.scale.y);g.setZ(e.scale.z);b.scale(g);b.setTotalMass(e.mass,
!1);L.addSoftBody(b,1,-1);y="softTrimesh"===e.type?y+3*b.get_m_faces().size():"softRopeMesh"===e.type?y+b.get_m_nodes().size():y+3*b.get_m_nodes().size();n++}else{b=R(e);if(!b)return;if(e.children){a=new Ammo.btCompoundShape;a.addChildShape(h,b);for(c=0;c<e.children.length;c++){b=e.children[c];var m=new Ammo.btTransform;m.setIdentity();g.setX(b.position_offset.x);g.setY(b.position_offset.y);g.setZ(b.position_offset.z);m.setOrigin(g);v.setX(b.rotation.x);v.setY(b.rotation.y);v.setZ(b.rotation.z);v.setW(b.rotation.w);
m.setRotation(v);b=R(e.children[c]);a.addChildShape(m,b);Ammo.destroy(m)}b=a;Q[e.id]=b}g.setX(e.scale.x);g.setY(e.scale.y);g.setZ(e.scale.z);b.setLocalScaling(g);b.setMargin(e.margin?e.margin:0);g.setX(0);g.setY(0);g.setZ(0);b.calculateLocalInertia(e.mass,g);h.setIdentity();t.setX(e.position.x);t.setY(e.position.y);t.setZ(e.position.z);h.setOrigin(t);v.setX(e.rotation.x);v.setY(e.rotation.y);v.setZ(e.rotation.z);v.setW(e.rotation.w);h.setRotation(v);a=new Ammo.btDefaultMotionState(h);c=new Ammo.btRigidBodyConstructionInfo(e.mass,
a,b,g);c.set_m_friction(e.friction);c.set_m_restitution(e.restitution);c.set_m_linearDamping(e.damping);c.set_m_angularDamping(e.damping);b=new Ammo.btRigidBody(c);b.setActivationState(e.state||4);Ammo.destroy(c);"undefined"!==typeof e.collision_flags&&b.setCollisionFlags(e.collision_flags);e.group&&e.mask?L.addRigidBody(b,e.group,e.mask):L.addRigidBody(b);b.type=1;B++}b.activate();b.id=e.id;r[b.id]=b;N[b.id]=a;G[void 0===b.a?b.ptr:b.a]=b.id;k++;f({cmd:"objectReady",params:b.id})};p.addVehicle=function(e){var a=
new Ammo.btVehicleTuning;a.set_m_suspensionStiffness(e.suspension_stiffness);a.set_m_suspensionCompression(e.suspension_compression);a.set_m_suspensionDamping(e.suspension_damping);a.set_m_maxSuspensionTravelCm(e.max_suspension_travel);a.set_m_maxSuspensionForce(e.max_suspension_force);var b=new Ammo.btRaycastVehicle(a,r[e.rigidBody],new Ammo.btDefaultVehicleRaycaster(L));b.tuning=a;r[e.rigidBody].setActivationState(4);b.setCoordinateSystem(0,1,2);L.addVehicle(b);w[e.id]=b};p.removeVehicle=function(e){w[e.id]=
null};p.addWheel=function(e){if(void 0!==w[e.id]){var a=w[e.id].tuning;void 0!==e.tuning&&(a=new Ammo.btVehicleTuning,a.set_m_suspensionStiffness(e.tuning.suspension_stiffness),a.set_m_suspensionCompression(e.tuning.suspension_compression),a.set_m_suspensionDamping(e.tuning.suspension_damping),a.set_m_maxSuspensionTravelCm(e.tuning.max_suspension_travel),a.set_m_maxSuspensionForce(e.tuning.max_suspension_force));g.setX(e.connection_point.x);g.setY(e.connection_point.y);g.setZ(e.connection_point.z);
t.setX(e.wheel_direction.x);t.setY(e.wheel_direction.y);t.setZ(e.wheel_direction.z);q.setX(e.wheel_axle.x);q.setY(e.wheel_axle.y);q.setZ(e.wheel_axle.z);w[e.id].addWheel(g,t,q,e.suspension_rest_length,e.wheel_radius,a,e.is_front_wheel)}x++;S?(I=new Float32Array(1+9*x),I[0]=2):I=[2]};p.setSteering=function(a){void 0!==w[a.id]&&w[a.id].setSteeringValue(a.steering,a.wheel)};p.setBrake=function(a){void 0!==w[a.id]&&w[a.id].setBrake(a.brake,a.wheel)};p.applyEngineForce=function(a){void 0!==w[a.id]&&w[a.id].applyEngineForce(a.force,
a.wheel)};p.removeObject=function(a){0===r[a.id].type?(n--,y-=r[a.id].get_m_nodes().size(),L.removeSoftBody(r[a.id])):1===r[a.id].type&&(B--,L.removeRigidBody(r[a.id]),Ammo.destroy(N[a.id]));Ammo.destroy(r[a.id]);Q[a.id]&&Ammo.destroy(Q[a.id]);J[a.id]&&Ammo.destroy(J[a.id]);G[void 0===r[a.id].a?r[a.id].a:r[a.id].ptr]=null;r[a.id]=null;N[a.id]=null;Q[a.id]&&(Q[a.id]=null);J[a.id]&&(J[a.id]=null);k--};p.updateTransform=function(a){m=r[a.id];1===m.type?(m.getMotionState().getWorldTransform(h),a.pos&&
(g.setX(a.pos.x),g.setY(a.pos.y),g.setZ(a.pos.z),h.setOrigin(g)),a.quat&&(v.setX(a.quat.x),v.setY(a.quat.y),v.setZ(a.quat.z),v.setW(a.quat.w),h.setRotation(v)),m.setWorldTransform(h),m.activate()):0===m.type&&(a.pos&&(g.setX(a.pos.x),g.setY(a.pos.y),g.setZ(a.pos.z),h.setOrigin(g)),a.quat&&(v.setX(a.quat.x),v.setY(a.quat.y),v.setZ(a.quat.z),v.setW(a.quat.w),h.setRotation(v)),m.transform(h))};p.updateMass=function(a){m=r[a.id];L.removeRigidBody(m);g.setX(0);g.setY(0);g.setZ(0);m.setMassProps(a.mass,
g);L.addRigidBody(m);m.activate()};p.applyCentralImpulse=function(a){g.setX(a.x);g.setY(a.y);g.setZ(a.z);r[a.id].applyCentralImpulse(g);r[a.id].activate()};p.applyImpulse=function(a){g.setX(a.impulse_x);g.setY(a.impulse_y);g.setZ(a.impulse_z);t.setX(a.x);t.setY(a.y);t.setZ(a.z);r[a.id].applyImpulse(g,t);r[a.id].activate()};p.applyTorque=function(a){g.setX(a.torque_x);g.setY(a.torque_y);g.setZ(a.torque_z);r[a.id].applyTorque(g);r[a.id].activate()};p.applyCentralForce=function(a){g.setX(a.x);g.setY(a.y);
g.setZ(a.z);r[a.id].applyCentralForce(g);r[a.id].activate()};p.applyForce=function(a){g.setX(a.force_x);g.setY(a.force_y);g.setZ(a.force_z);t.setX(a.x);t.setY(a.y);t.setZ(a.z);r[a.id].applyForce(g,t);r[a.id].activate()};p.onSimulationResume=function(){Date.now()};p.setAngularVelocity=function(a){g.setX(a.x);g.setY(a.y);g.setZ(a.z);r[a.id].setAngularVelocity(g);r[a.id].activate()};p.setLinearVelocity=function(a){g.setX(a.x);g.setY(a.y);g.setZ(a.z);r[a.id].setLinearVelocity(g);r[a.id].activate()};p.setAngularFactor=
function(a){g.setX(a.x);g.setY(a.y);g.setZ(a.z);r[a.id].setAngularFactor(g)};p.setLinearFactor=function(a){g.setX(a.x);g.setY(a.y);g.setZ(a.z);r[a.id].setLinearFactor(g)};p.setDamping=function(a){r[a.id].setDamping(a.linear,a.angular)};p.setCcdMotionThreshold=function(a){r[a.id].setCcdMotionThreshold(a.threshold)};p.setCcdSweptSphereRadius=function(a){r[a.id].setCcdSweptSphereRadius(a.radius)};p.addConstraint=function(a){switch(a.type){case "point":if(void 0===a.objectb){g.setX(a.positiona.x);g.setY(a.positiona.y);
g.setZ(a.positiona.z);var b=new Ammo.btPoint2PointConstraint(r[a.objecta],g)}else g.setX(a.positiona.x),g.setY(a.positiona.y),g.setZ(a.positiona.z),t.setX(a.positionb.x),t.setY(a.positionb.y),t.setZ(a.positionb.z),b=new Ammo.btPoint2PointConstraint(r[a.objecta],r[a.objectb],g,t);break;case "hinge":void 0===a.objectb?(g.setX(a.positiona.x),g.setY(a.positiona.y),g.setZ(a.positiona.z),t.setX(a.axis.x),t.setY(a.axis.y),t.setZ(a.axis.z),b=new Ammo.btHingeConstraint(r[a.objecta],g,t)):(g.setX(a.positiona.x),
g.setY(a.positiona.y),g.setZ(a.positiona.z),t.setX(a.positionb.x),t.setY(a.positionb.y),t.setZ(a.positionb.z),q.setX(a.axis.x),q.setY(a.axis.y),q.setZ(a.axis.z),b=new Ammo.btHingeConstraint(r[a.objecta],r[a.objectb],g,t,q,q));break;case "slider":var f=void 0,e=new Ammo.btTransform;g.setX(a.positiona.x);g.setY(a.positiona.y);g.setZ(a.positiona.z);e.setOrigin(g);b=e.getRotation();b.setEuler(a.axis.x,a.axis.y,a.axis.z);e.setRotation(b);a.objectb?(f=new Ammo.btTransform,t.setX(a.positionb.x),t.setY(a.positionb.y),
t.setZ(a.positionb.z),f.setOrigin(t),b=f.getRotation(),b.setEuler(a.axis.x,a.axis.y,a.axis.z),f.setRotation(b),b=new Ammo.btSliderConstraint(r[a.objecta],r[a.objectb],e,f,!0)):b=new Ammo.btSliderConstraint(r[a.objecta],e,!0);b.ta=e;b.tb=f;Ammo.destroy(e);void 0!==f&&Ammo.destroy(f);break;case "conetwist":f=new Ammo.btTransform;f.setIdentity();e=new Ammo.btTransform;e.setIdentity();g.setX(a.positiona.x);g.setY(a.positiona.y);g.setZ(a.positiona.z);t.setX(a.positionb.x);t.setY(a.positionb.y);t.setZ(a.positionb.z);
f.setOrigin(g);e.setOrigin(t);b=f.getRotation();b.setEulerZYX(-a.axisa.z,-a.axisa.y,-a.axisa.x);f.setRotation(b);b=e.getRotation();b.setEulerZYX(-a.axisb.z,-a.axisb.y,-a.axisb.x);e.setRotation(b);b=new Ammo.btConeTwistConstraint(r[a.objecta],r[a.objectb],f,e);b.setLimit(Math.PI,0,Math.PI);b.ta=f;b.tb=e;Ammo.destroy(f);Ammo.destroy(e);break;case "dof":f=void 0;e=new Ammo.btTransform;e.setIdentity();g.setX(a.positiona.x);g.setY(a.positiona.y);g.setZ(a.positiona.z);e.setOrigin(g);b=e.getRotation();b.setEulerZYX(-a.axisa.z,
-a.axisa.y,-a.axisa.x);e.setRotation(b);a.objectb?(f=new Ammo.btTransform,f.setIdentity(),t.setX(a.positionb.x),t.setY(a.positionb.y),t.setZ(a.positionb.z),f.setOrigin(t),b=f.getRotation(),b.setEulerZYX(-a.axisb.z,-a.axisb.y,-a.axisb.x),f.setRotation(b),b=new Ammo.btGeneric6DofConstraint(r[a.objecta],r[a.objectb],e,f,!0)):b=new Ammo.btGeneric6DofConstraint(r[a.objecta],e,!0);b.ta=e;b.tb=f;Ammo.destroy(e);void 0!==f&&Ammo.destroy(f);break;default:return}L.addConstraint(b);b.a=r[a.objecta];b.b=r[a.objectb];
b.enableFeedback();E[a.id]=b;u++;S?(M=new Float32Array(1+6*u),M[0]=3):M=[3]};p.removeConstraint=function(a){var b=E[a.id];void 0!==b&&(L.removeConstraint(b),E[a.id]=null,u--)};p.constraint_setBreakingImpulseThreshold=function(a){var b=E[a.id];b!==undefind&&b.setBreakingImpulseThreshold(a.threshold)};p.simulate=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(L){a.timeStep&&a.timeStep<C&&(a.timeStep=C);a.maxSubSteps=a.maxSubSteps||Math.ceil(a.timeStep/C);L.stepSimulation(a.timeStep,
a.maxSubSteps,C);if(0<w.length){S&&I.length<2+9*x&&(I=new Float32Array(2+Math.ceil(x/D)*D*9),I[0]=2);for(var b=a=0,c=w.length;c--;)if(w[c]){var m=w[c];for(b=0;b<m.getNumWheels();b++){var h=m.getWheelInfo(b).get_m_worldTransform(),g=h.getOrigin();h=h.getRotation();var z=1+9*a++;I[z]=c;I[z+1]=b;I[z+2]=g.x();I[z+3]=g.y();I[z+4]=g.z();I[z+5]=h.x();I[z+6]=h.y();I[z+7]=h.z();I[z+8]=h.w()}}S&&0!==b?f(I.buffer,[I.buffer]):0!==b&&f(I)}a=L.getDispatcher();b=a.getNumManifolds();S&&P.length<2+5*b&&(P=new Float32Array(2+
Math.ceil(k/D)*D*5),P[0]=1);for(c=P[1]=0;c<b;c++)if(m=a.getManifoldByIndexInternal(c),g=m.getNumContacts(),0!==g)for(;0<g;){g=m.getContactPoint(0);h=2+5*P[1]++;P[h]=G[m.getBody0().ptr];P[h+1]=G[m.getBody1().ptr];d=g.get_m_normalWorldOnB();P[h+2]=d.x();P[h+3]=d.y();P[h+4]=d.z();break}S?f(P.buffer,[P.buffer]):f(P);if(0<E.length){S&&M.length<2+6*u&&(M=new Float32Array(2+Math.ceil(u/D)*D*6),M[0]=3);b=0;for(c=E.lenght;c--;)E[c]&&(m=E[c],g=m.a,h=m.ta.getOrigin(),a=1+6*b++,M[a]=c,M[a+1]=g.id,M[a+2]=h.x,
M[a+3]=h.y,M[a+4]=h.z,M[a+5]=m.getBreakingImpulseThreshold());S&&0!==b?f(M.buffer,[M.buffer]):0!==b&&f(M)}S&&H.length<2+14*B&&(H=new Float32Array(2+Math.ceil(B/D)*D*14),H[0]=0);H[1]=B;a=0;for(b=r.length;b--;)(c=r[b])&&1===c.type&&(g=c.getCenterOfMassTransform(),m=g.getOrigin(),g=g.getRotation(),h=2+14*a++,H[h]=c.id,H[h+1]=m.x(),H[h+2]=m.y(),H[h+3]=m.z(),H[h+4]=g.x(),H[h+5]=g.y(),H[h+6]=g.z(),H[h+7]=g.w(),d=c.getLinearVelocity(),H[h+8]=d.x(),H[h+9]=d.y(),H[h+10]=d.z(),d=c.getAngularVelocity(),H[h+
11]=d.x(),H[h+12]=d.y(),H[h+13]=d.z());S?f(H.buffer,[H.buffer]):f(H);if(l){A=new Float32Array(2+2*n+6*y);A[0]=4;A[1]=n;a=2;for(b=r.length;b--;)if((m=r[b])&&0===m.type)if(A[a]=m.id,c=a+2,!0===m.rope){m=m.get_m_nodes();g=m.size();A[a+1]=g;for(h=0;h<g;h++){z=m.at(h).get_m_x();var K=c+3*h;A[K]=z.x();A[K+1]=z.y();A[K+2]=z.z()}a+=3*g+2}else if(m.cloth){m=m.get_m_nodes();g=m.size();A[a+1]=g;for(h=0;h<g;h++){K=m.at(h);z=K.get_m_x();K=K.get_m_n();var p=c+6*h;A[p]=z.x();A[p+1]=z.y();A[p+2]=z.z();A[p+3]=K.x();
A[p+4]=K.y();A[p+5]=K.z()}a+=6*g+2}else{m=m.get_m_faces();g=m.size();A[a+1]=g;for(h=0;h<g;h++){z=m.at(h);var t=z.get_m_n(0),W=z.get_m_n(1),q=z.get_m_n(2);z=t.get_m_x();K=W.get_m_x();p=q.get_m_x();t=t.get_m_n();W=W.get_m_n();q=q.get_m_n();var v=c+18*h;A[v]=z.x();A[v+1]=z.y();A[v+2]=z.z();A[v+3]=t.x();A[v+4]=t.y();A[v+5]=t.z();A[v+6]=K.x();A[v+7]=K.y();A[v+8]=K.z();A[v+9]=W.x();A[v+10]=W.y();A[v+11]=W.z();A[v+12]=p.x();A[v+13]=p.y();A[v+14]=p.z();A[v+15]=q.x();A[v+16]=q.y();A[v+17]=q.z()}a+=18*g+2}f(A)}}};
p.hinge_setLimits=function(a){E[a.constraint].setLimit(a.low,a.high,0,a.bias_factor,a.relaxation_factor)};p.hinge_enableAngularMotor=function(a){var b=E[a.constraint];b.enableAngularMotor(!0,a.velocity,a.acceleration);b.a.activate();b.b&&b.b.activate()};p.hinge_disableMotor=function(a){E[a.constraint].enableMotor(!1);constraint.b&&constraint.b.activate()};p.slider_setLimits=function(a){var b=E[a.constraint];b.setLowerLinLimit(a.lin_lower||0);b.setUpperLinLimit(a.lin_upper||0);b.setLowerAngLimit(a.ang_lower||
0);b.setUpperAngLimit(a.ang_upper||0)};p.slider_setRestitution=function(a){var b=E[a.constraint];b.setSoftnessLimLin(a.linear||0);b.setSoftnessLimAng(a.angular||0)};p.slider_enableLinearMotor=function(a){var b=E[a.constraint];b.setTargetLinMotorVelocity(a.velocity);b.setMaxLinMotorForce(a.acceleration);b.setPoweredLinMotor(!0);b.a.activate();b.b&&b.b.activate()};p.slider_disableLinearMotor=function(a){a=E[a.constraint];a.setPoweredLinMotor(!1);a.b&&a.b.activate()};p.slider_enableAngularMotor=function(a){var b=
E[a.constraint];b.setTargetAngMotorVelocity(a.velocity);b.setMaxAngMotorForce(a.acceleration);b.setPoweredAngMotor(!0);b.a.activate();b.b&&b.b.activate()};p.slider_disableAngularMotor=function(a){a=E[a.constraint];a.setPoweredAngMotor(!1);a.a.activate();a.b&&a.b.activate()};p.conetwist_setLimit=function(a){E[a.constraint].setLimit(a.z,a.y,a.x)};p.conetwist_enableMotor=function(a){a=E[a.constraint];a.enableMotor(!0);a.a.activate();a.b.activate()};p.conetwist_setMaxMotorImpulse=function(a){var b=E[a.constraint];
b.setMaxMotorImpulse(a.max_impulse);b.a.activate();b.b.activate()};p.conetwist_setMotorTarget=function(a){var b=E[a.constraint];v.setX(a.x);v.setY(a.y);v.setZ(a.z);v.setW(a.w);b.setMotorTarget(v);b.a.activate();b.b.activate()};p.conetwist_disableMotor=function(a){a=E[a.constraint];a.enableMotor(!1);a.a.activate();a.b.activate()};p.dof_setLinearLowerLimit=function(a){var b=E[a.constraint];g.setX(a.x);g.setY(a.y);g.setZ(a.z);b.setLinearLowerLimit(g);b.a.activate();b.b&&b.b.activate()};p.dof_setLinearUpperLimit=
function(a){var b=E[a.constraint];g.setX(a.x);g.setY(a.y);g.setZ(a.z);b.setLinearUpperLimit(g);b.a.activate();b.b&&b.b.activate()};p.dof_setAngularLowerLimit=function(a){var b=E[a.constraint];g.setX(a.x);g.setY(a.y);g.setZ(a.z);b.setAngularLowerLimit(g);b.a.activate();b.b&&b.b.activate()};p.dof_setAngularUpperLimit=function(a){var b=E[a.constraint];g.setX(a.x);g.setY(a.y);g.setZ(a.z);b.setAngularUpperLimit(g);b.a.activate();b.b&&b.b.activate()};p.dof_enableAngularMotor=function(a){var b=E[a.constraint];
b.getRotationalLimitMotor(a.which).set_m_enableMotor(!0);b.a.activate();b.b&&b.b.activate()};p.dof_configureAngularMotor=function(a){var b=E[a.constraint],f=b.getRotationalLimitMotor(a.which);f.set_m_loLimit(a.low_angle);f.set_m_hiLimit(a.high_angle);f.set_m_targetVelocity(a.velocity);f.set_m_maxMotorForce(a.max_force);b.a.activate();b.b&&b.b.activate()};p.dof_disableAngularMotor=function(a){var b=E[a.constraint];b.getRotationalLimitMotor(a.which).set_m_enableMotor(!1);b.a.activate();b.b&&b.b.activate()};
a.onmessage=function(a){if(a.data instanceof Float32Array)switch(a.data[0]){case 0:H=new Float32Array(a.data);break;case 1:P=new Float32Array(a.data);break;case 2:I=new Float32Array(a.data);break;case 3:M=new Float32Array(a.data)}else if(a.data.cmd&&p[a.data.cmd])p[a.data.cmd](a.data.params)}});Y=function(d){function b(a){y(this,b);var f=R(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.bridge={onAdd:function(a,b){if(a.use("physics"))return b.defer(b.onAddCallback.bind(b),[a])},onRemove:function(a,
b){if(a.use("physics"))return b.defer(b.onRemoveCallback.bind(b),[a])}};f.params=Object.assign({fixedTimeStep:1/60,rateLimit:!0,ammo:"",softbody:!1,gravity:new c.Vector3(0,-100,0)},a);var m=performance.now();f.worker=new wa;f.worker.transferableMessage=f.worker.webkitPostMessage||f.worker.postMessage;f.isLoaded=!1;f.loader=new Promise(function(b,c){a.wasm?fetch(a.wasm).then(function(a){return a.arrayBuffer()}).then(function(a){f.params.wasmBuffer=a;f.execute("init",f.params);b()}):(f.execute("init",
f.params),b())});f.loader.then(function(){f.isLoaded=!0});f._materials_ref_counts={};f._objects={};f._vehicles={};f._constraints={};f._is_simulating=!1;f.getObjectId=function(){var a=1;return function(){return a++}}();var d=new ArrayBuffer(1);f.worker.transferableMessage(d,[d]);f.SUPPORT_TRANSFERABLE=0===d.byteLength;f.worker.onmessage=function(a){a=a.data;a instanceof ArrayBuffer&&1!==a.byteLength&&(a=new Float32Array(a));if(a instanceof Float32Array)switch(a[0]){case w.WORLDREPORT:f.updateScene(a);
break;case w.SOFTREPORT:f.updateSoftbodies(a);break;case w.COLLISIONREPORT:f.updateCollisions(a);break;case w.VEHICLEREPORT:f.updateVehicles(a);break;case w.CONSTRAINTREPORT:f.updateConstraints(a)}else if(a.cmd)switch(a.cmd){case "objectReady":a=a.params;f._objects[a]&&f._objects[a].dispatchEvent("ready");break;case "worldReady":f.dispatchEvent("ready");break;case "ammoLoaded":f.dispatchEvent("loaded");console.log("Physics loading time: "+(performance.now()-m)+"ms");break;case "vehicle":window.test=
a;break;default:console.debug("Received: "+a.cmd),console.dir(a.params)}else switch(a[0]){case w.WORLDREPORT:f.updateScene(a);break;case w.COLLISIONREPORT:f.updateCollisions(a);break;case w.VEHICLEREPORT:f.updateVehicles(a);break;case w.CONSTRAINTREPORT:f.updateConstraints(a)}};return f}O(b,d);G(b,[{key:"updateScene",value:function(a){for(var b=a[1];b--;){var c=2+14*b,d=this._objects[a[c]],h=d.component,l=h.use("physics").data;null!==d&&(!1===h.__dirtyPosition&&(d.position.set(a[c+1],a[c+2],a[c+3]),
h.__dirtyPosition=!1),!1===h.__dirtyRotation&&(d.quaternion.set(a[c+4],a[c+5],a[c+6],a[c+7]),h.__dirtyRotation=!1),l.linearVelocity.set(a[c+8],a[c+9],a[c+10]),l.angularVelocity.set(a[c+11],a[c+12],a[c+13]))}this.SUPPORT_TRANSFERABLE&&this.worker.transferableMessage(a.buffer,[a.buffer]);this._is_simulating=!1;this.dispatchEvent("update")}},{key:"updateSoftbodies",value:function(a){for(var b=a[1],c=2;b--;){var d=a[c+1],h=this._objects[a[c]];if(null!==h){var l=h.component._physijs,k=h.geometry.attributes,
B=k.position.array,u=c+2;l.isSoftBodyReset||(h.position.set(0,0,0),h.quaternion.set(0,0,0,0),l.isSoftBodyReset=!0);if("softTrimesh"===l.type){h=k.normal.array;for(l=0;l<d;l++){var x=u+18*l,q=a[x+1],n=a[x+2],w=a[x+3],y=a[x+4],g=a[x+5],t=a[x+6],C=a[x+7],v=a[x+8],p=a[x+9],r=a[x+10],F=a[x+11],E=a[x+12],G=a[x+13],J=a[x+14],N=a[x+15],O=a[x+16],Q=a[x+17],D=9*l;B[D]=a[x];B[D+1]=q;B[D+2]=n;B[D+3]=t;B[D+4]=C;B[D+5]=v;B[D+6]=E;B[D+7]=G;B[D+8]=J;h[D]=w;h[D+1]=y;h[D+2]=g;h[D+3]=p;h[D+4]=r;h[D+5]=F;h[D+6]=N;h[D+
7]=O;h[D+8]=Q}k.normal.needsUpdate=!0;c+=2+18*d}else if("softRopeMesh"===l.type){for(h=0;h<d;h++)l=u+3*h,x=a[l+1],q=a[l+2],B[3*h]=a[l],B[3*h+1]=x,B[3*h+2]=q;c+=2+3*d}else{h=k.normal.array;for(l=0;l<d;l++)x=u+6*l,q=a[x+1],n=a[x+2],w=a[x+3],y=a[x+4],g=a[x+5],B[3*l]=a[x],B[3*l+1]=q,B[3*l+2]=n,h[3*l]=w,h[3*l+1]=y,h[3*l+2]=g;k.normal.needsUpdate=!0;c+=2+6*d}k.position.needsUpdate=!0}}this._is_simulating=!1}},{key:"updateVehicles",value:function(a){for(var b,c=0;c<(a.length-1)/9;c++){var d=1+9*c;b=this._vehicles[a[d]];
null!==b&&(b=b.wheels[a[d+1]],b.position.set(a[d+2],a[d+3],a[d+4]),b.quaternion.set(a[d+5],a[d+6],a[d+7],a[d+8]))}this.SUPPORT_TRANSFERABLE&&this.worker.transferableMessage(a.buffer,[a.buffer])}},{key:"updateConstraints",value:function(a){for(var b,c,d=0;d<(a.length-1)/6;d++){var h=1+6*d;b=this._constraints[a[h]];c=this._objects[a[h+1]];void 0!==b&&void 0!==c&&(u.set(a[h+2],a[h+3],a[h+4]),Q.extractRotation(c.matrix),u.applyMatrix4(Q),b.positiona.addVectors(c.position,u),b.appliedImpulse=a[h+5])}this.SUPPORT_TRANSFERABLE&&
this.worker.transferableMessage(a.buffer,[a.buffer])}},{key:"updateCollisions",value:function(a){for(var b={},c={},d=0;d<a[1];d++){var h=2+5*d,l=a[h],k=a[h+1];c[l+"-"+k]=h+2;c[k+"-"+l]=-1*(h+2);b[l]||(b[l]=[]);b[l].push(k);b[k]||(b[k]=[]);b[k].push(l)}for(var B in this._objects)if(this._objects.hasOwnProperty(B)&&(l=this._objects[B],d=l.component,h=d.use("physics").data,null!==l))if(b[B]){for(l=0;l<h.touches.length;l++)-1===b[B].indexOf(h.touches[l])&&h.touches.splice(l--,1);for(l=0;l<b[B].length;l++){var q=
b[B][l];k=this._objects[q];var x=k.component,n=x.use("physics").data;k&&-1===h.touches.indexOf(q)&&(h.touches.push(q),q=d.use("physics").getLinearVelocity(),x=x.use("physics").getLinearVelocity(),u.subVectors(q,x),x=u.clone(),q=u.clone(),n=c[h.id+"-"+n.id],0<n?u.set(-h[n],-h[n+1],-h[n+2]):(n*=-1,u.set(h[n],h[n+1],h[n+2])),d.emit("collision",k,x,q,u))}}else h.touches.length=0;this.collisions=b;this.SUPPORT_TRANSFERABLE&&this.worker.transferableMessage(a.buffer,[a.buffer])}},{key:"addConstraint",value:function(a,
b){a.id=this.getObjectId();this._constraints[a.id]=a;a.worldModule=this;this.execute("addConstraint",a.getDefinition());if(b)switch(a.type){case "point":b=new c.Mesh(new c.SphereGeometry(1.5),new c.MeshNormalMaterial);b.position.copy(a.positiona);this._objects[a.objecta].add(b);break;case "hinge":b=new c.Mesh(new c.SphereGeometry(1.5),new c.MeshNormalMaterial);b.position.copy(a.positiona);this._objects[a.objecta].add(b);break;case "slider":b=new c.Mesh(new c.BoxGeometry(10,1,1),new c.MeshNormalMaterial);
b.position.copy(a.positiona);b.rotation.set(a.axis.y,a.axis.x,a.axis.z);this._objects[a.objecta].add(b);break;case "conetwist":b=new c.Mesh(new c.SphereGeometry(1.5),new c.MeshNormalMaterial);b.position.copy(a.positiona);this._objects[a.objecta].add(b);break;case "dof":b=new c.Mesh(new c.SphereGeometry(1.5),new c.MeshNormalMaterial),b.position.copy(a.positiona),this._objects[a.objecta].add(b)}return a}},{key:"onSimulationResume",value:function(){this.execute("onSimulationResume",{})}},{key:"removeConstraint",
value:function(a){void 0!==this._constraints[a.id]&&(this.execute("removeConstraint",{id:a.id}),delete this._constraints[a.id])}},{key:"execute",value:function(a,b){this.worker.postMessage({cmd:a,params:b})}},{key:"onAddCallback",value:function(a){var b=a.native,c=b.component.use("physics").data;c&&(a.manager.set("module:world",this),c.id=this.getObjectId(),b instanceof la?(this.onAddCallback(b.mesh),this._vehicles[c.id]=b,this.execute("addVehicle",c)):(a.__dirtyPosition=!1,a.__dirtyRotation=!1,this._objects[c.id]=
b,b.children.length&&(c.children=[],ha(b,b)),b.material._physijs&&(this._materials_ref_counts.hasOwnProperty(b.material._physijs.id)?this._materials_ref_counts[b.material._physijs.id]++:(this.execute("registerMaterial",b.material._physijs),c.materialId=b.material._physijs.id,this._materials_ref_counts[b.material._physijs.id]=1)),c.position={x:b.position.x,y:b.position.y,z:b.position.z},c.rotation={x:b.quaternion.x,y:b.quaternion.y,z:b.quaternion.z,w:b.quaternion.w},c.width&&(c.width*=b.scale.x),c.height&&
(c.height*=b.scale.y),c.depth&&(c.depth*=b.scale.z),this.execute("addObject",c)),a.emit("physics:added"))}},{key:"onRemoveCallback",value:function(a){var b=a.native;if(b instanceof la){for(this.execute("removeVehicle",{id:b._physijs.id});b.wheels.length;)this.remove(b.wheels.pop());this.remove(b.mesh);this._vehicles[b._physijs.id]=null}else b._physijs&&(a.manager.remove("module:world"),this._objects[b._physijs.id]=null,this.execute("removeObject",{id:b._physijs.id}));b.material&&b.material._physijs&&
this._materials_ref_counts.hasOwnProperty(b.material._physijs.id)&&(this._materials_ref_counts[b.material._physijs.id]--,0===this._materials_ref_counts[b.material._physijs.id]&&(this.execute("unRegisterMaterial",b.material._physijs),this._materials_ref_counts[b.material._physijs.id]=null))}},{key:"defer",value:function(a,b){var c=this;return new Promise(function(f){c.isLoaded?(a.apply(void 0,ja(b)),f()):c.loader.then(function(){a.apply(void 0,ja(b));f()})})}},{key:"manager",value:function(a){a.set("physicsWorker",
this.worker)}},{key:"integrate",value:function(a){var b=this,c=a.params;this.setFixedTimeStep=function(b){b&&a.execute("setFixedTimeStep",b)};this.setGravity=function(b){b&&a.execute("setGravity",b)};this.addConstraint=a.addConstraint.bind(a);this.simulate=function(b,c){a._stats&&a._stats.begin();if(a._is_simulating)return!1;a._is_simulating=!0;for(var f in a._objects)if(a._objects.hasOwnProperty(f)){var d=a._objects[f],m=d.component,h=m.use("physics").data;if(null!==d&&(m.__dirtyPosition||m.__dirtyRotation)){var l=
{id:h.id};m.__dirtyPosition&&(l.pos={x:d.position.x,y:d.position.y,z:d.position.z},h.isSoftbody&&d.position.set(0,0,0),m.__dirtyPosition=!1);m.__dirtyRotation&&(l.quat={x:d.quaternion.x,y:d.quaternion.y,z:d.quaternion.z,w:d.quaternion.w},h.isSoftbody&&d.rotation.set(0,0,0),m.__dirtyRotation=!1);a.execute("updateTransform",l)}}a.execute("simulate",{timeStep:b,maxSubSteps:c});a._stats&&a._stats.end();return!0};a.loader.then(function(){a.simulateLoop=new q.Loop(function(a){b.simulate(a.getDelta(),1)});
a.simulateLoop.start(b);b.setGravity(c.gravity)})}}]);return b}(ka);var fa={position:{get:function(){return this._native.position},set:function(c){var b=this._native.position,a=this;Object.defineProperties(b,{x:{get:function(){return this._x},set:function(b){a.__dirtyPosition=!0;this._x=b}},y:{get:function(){return this._y},set:function(b){a.__dirtyPosition=!0;this._y=b}},z:{get:function(){return this._z},set:function(b){a.__dirtyPosition=!0;this._z=b}}});a.__dirtyPosition=!0;b.copy(c)}},quaternion:{get:function(){this.__c_rot=
!0;return this.native.quaternion},set:function(c){var b=this,a=this._native.quaternion,f=this._native;a.copy(c);a.onChange(function(){b.__c_rot&&(!0===f.__dirtyRotation&&(b.__c_rot=!1,f.__dirtyRotation=!1),f.__dirtyRotation=!0)})}},rotation:{get:function(){this.__c_rot=!0;return this._native.rotation},set:function(d){var b=this,a=this._native.rotation,f=this._native;this.quaternion.copy((new c.Quaternion).setFromEuler(d));a.onChange(function(){b.__c_rot&&(b.quaternion.copy((new c.Quaternion).setFromEuler(a)),
f.__dirtyRotation=!0)})}}},ca,da,N=(da=ca=function(c){function b(a,c){y(this,b);var f=R(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.bridge={onCopy:n,onWrap:C};f.data=Object.assign(a,c);return f}O(b,c);G(b,[{key:"integrate",value:function(a){k(this)}},{key:"manager",value:function(a){a.define("physics");this.execute=function(){var b;return a.has("module:world")?(b=a.get("module:world")).execute.apply(b,arguments):function(){}}}},{key:"updateData",value:function(a){this.bridge.geometry=
function(b,c){a&&a(b,c);return b}}}]);return b}(function(){function c(){y(this,c)}G(c,[{key:"applyCentralImpulse",value:function(b){this.execute("applyCentralImpulse",{id:this.data.id,x:b.x,y:b.y,z:b.z})}},{key:"applyImpulse",value:function(b,a){this.execute("applyImpulse",{id:this.data.id,impulse_x:b.x,impulse_y:b.y,impulse_z:b.z,x:a.x,y:a.y,z:a.z})}},{key:"applyTorque",value:function(b){this.execute("applyTorque",{id:this.data.id,torque_x:b.x,torque_y:b.y,torque_z:b.z})}},{key:"applyCentralForce",
value:function(b){this.execute("applyCentralForce",{id:this.data.id,x:b.x,y:b.y,z:b.z})}},{key:"applyForce",value:function(b,a){this.execute("applyForce",{id:this.data.id,force_x:b.x,force_y:b.y,force_z:b.z,x:a.x,y:a.y,z:a.z})}},{key:"getAngularVelocity",value:function(){return this.data.angularVelocity}},{key:"setAngularVelocity",value:function(b){this.execute("setAngularVelocity",{id:this.data.id,x:b.x,y:b.y,z:b.z})}},{key:"getLinearVelocity",value:function(){return this.data.linearVelocity}},{key:"setLinearVelocity",
value:function(b){this.execute("setLinearVelocity",{id:this.data.id,x:b.x,y:b.y,z:b.z})}},{key:"setAngularFactor",value:function(b){this.execute("setAngularFactor",{id:this.data.id,x:b.x,y:b.y,z:b.z})}},{key:"setLinearFactor",value:function(b){this.execute("setLinearFactor",{id:this.data.id,x:b.x,y:b.y,z:b.z})}},{key:"setDamping",value:function(b,a){this.execute("setDamping",{id:this.data.id,linear:b,angular:a})}},{key:"setCcdMotionThreshold",value:function(b){this.execute("setCcdMotionThreshold",
{id:this.data.id,threshold:b})}},{key:"setCcdSweptSphereRadius",value:function(b){this.execute("setCcdSweptSphereRadius",{id:this.data.id,radius:b})}}]);return c}()),ca.rigidbody=function(){return{touches:[],linearVelocity:new c.Vector3,angularVelocity:new c.Vector3,mass:10,scale:new c.Vector3(1,1,1),restitution:.3,friction:.8,damping:0,margin:0}},da);ca=function(c){function b(a){y(this,b);a=R(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,U({type:"box"},N.rigidbody()),a));a.updateData(function(a,
b){b=b.data;a.boundingBox||a.computeBoundingBox();b.width=a.boundingBox.max.x-a.boundingBox.min.x;b.height=a.boundingBox.max.y-a.boundingBox.min.y;b.depth=a.boundingBox.max.z-a.boundingBox.min.z});return a}O(b,c);return b}(N);da=function(c){function b(a){y(this,b);return R(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,U({type:"compound"},N.rigidbody()),a))}O(b,c);return b}(N);aa=function(c){function b(a){y(this,b);a=R(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,U({type:"capsule"},
N.rigidbody()),a));a.updateData(function(a,b){b=b.data;a.boundingBox||a.computeBoundingBox();b.width=a.boundingBox.max.x-a.boundingBox.min.x;b.height=a.boundingBox.max.y-a.boundingBox.min.y;b.depth=a.boundingBox.max.z-a.boundingBox.min.z});return a}O(b,c);return b}(N);ba=function(c){function b(a){y(this,b);var c=R(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,U({type:"concave"},N.rigidbody()),a));c.updateData(function(a,b){b.data.data=c.geometryProcessor(a)});return c}O(b,c);G(b,[{key:"geometryProcessor",
value:function(a){var b="BufferGeometry"===a.type;a.boundingBox||a.computeBoundingBox();var c=b?a.attributes.position.array:new Float32Array(9*a.faces.length);if(!b){b=a.vertices;for(var d=0;d<a.faces.length;d++){var h=a.faces[d],l=b[h.a],k=b[h.b];h=b[h.c];var n=9*d;c[n]=l.x;c[n+1]=l.y;c[n+2]=l.z;c[n+3]=k.x;c[n+4]=k.y;c[n+5]=k.z;c[n+6]=h.x;c[n+7]=h.y;c[n+8]=h.z}}return c}}]);return b}(N);var xa=function(){function d(b){y(this,d);this.bridge={geometry:function(a){a.boundingBox||a.computeBoundingBox();
this._physijs.radius=(a.boundingBox.max.x-a.boundingBox.min.x)/2;this._physijs.height=a.boundingBox.max.y-a.boundingBox.min.y;return a},onCopy:n,onWrap:C};this.params=Object.assign({mass:10,scale:new c.Vector3(1,1,1),restitution:.3,friction:.8,damping:0,margin:0},b)}G(d,[{key:"integrate",value:function(b){b=b.params;this._physijs={type:"cone",mass:b.mass,touches:[],linearVelocity:new c.Vector3,angularVelocity:new c.Vector3,group:b.group,mask:b.mask,friction:b.friction,restitution:b.restitution,damping:b.damping,
scale:b.scale,margin:b.margin};k(this)}}]);return d}(),ya=function(){function d(b){y(this,d);this.bridge={mesh:function(a){var b=a.geometry;b.boundingBox||b.computeBoundingBox();var d="BufferGeometry"===b.type;d||(b._bufferGeometry=(new c.BufferGeometry).fromGeometry(b));this._physijs.data=d?b.attributes.position.array:b._bufferGeometry.attributes.position.array;return a},onCopy:n,onWrap:C};this.params=Object.assign({mass:10,restitution:.3,friction:.8,damping:0,margin:0,scale:new c.Vector3(1,1,1)},
b)}G(d,[{key:"integrate",value:function(b){b=b.params;this._physijs={type:"convex",mass:b.mass,touches:[],linearVelocity:new c.Vector3,angularVelocity:new c.Vector3,group:b.group,mask:b.mask,friction:b.friction,restitution:b.restitution,damping:b.damping,margin:b.margin,scale:b.scale};k(this)}}]);return d}(),za=function(){function d(b){y(this,d);this.bridge={geometry:function(a){a.boundingBox||a.computeBoundingBox();this._physijs.width=a.boundingBox.max.x-a.boundingBox.min.x;this._physijs.height=
a.boundingBox.max.y-a.boundingBox.min.y;this._physijs.depth=a.boundingBox.max.z-a.boundingBox.min.z;return a},onCopy:n,onWrap:C};this.params=Object.assign({mass:10,restitution:.3,friction:.8,damping:0,margin:0,scale:new c.Vector3(1,1,1)},b)}G(d,[{key:"integrate",value:function(b){b=b.params;this._physijs={type:"cylinder",width:b.width,height:b.height,depth:b.depth,touches:[],linearVelocity:new c.Vector3,angularVelocity:new c.Vector3,group:b.group,mask:b.mask,friction:b.friction,restitution:b.restitution,
damping:b.damping,margin:b.margin,mass:b.mass,scale:b.scale};k(this)}}]);return d}(),Aa=function(){function d(b){y(this,d);this.bridge={geometry:function(a,b){var f=a instanceof c.BufferGeometry,d=f?a.attributes.position.array:a.vertices,h=f?d.length/3:d.length;a.boundingBox||a.computeBoundingBox();var l=b.params.size.x,k=b.params.size.y,n=a.boundingBox.max.x-a.boundingBox.min.x,q=a.boundingBox.max.z-a.boundingBox.min.z;this._physijs.xpts="undefined"===typeof l?Math.sqrt(h):l+1;this._physijs.ypts=
"undefined"===typeof k?Math.sqrt(h):k+1;this._physijs.absMaxHeight=Math.max(a.boundingBox.max.y,Math.abs(a.boundingBox.min.y));l=new Float32Array(h);k=this._physijs.xpts;for(var u=this._physijs.ypts;h--;){var w=h%k+(u-Math.round(h/k-h%k/k)-1)*u;l[h]=f?d[3*w+1]:d[w].y}this._physijs.points=l;this._physijs.scale.multiply(new THREE.Vector3(n/(k-1),1,q/(u-1)));b.params.autoAlign&&a.translate(n/-2,0,q/-2);return a},onCopy:n,onWrap:C};this.params=Object.assign({mass:10,scale:new c.Vector3(1,1,1),size:new c.Vector2(1,
1),restitution:.3,friction:.8,damping:0,margin:0,autoAlign:!1},b)}G(d,[{key:"integrate",value:function(b){b=b.params;this._physijs={type:"heightfield",friction:b.friction,touches:[],scale:b.scale,restitution:b.restitution,damping:b.damping,margin:b.margin,points:b.points,mass:b.mass,linearVelocity:new c.Vector3,angularVelocity:new c.Vector3,group:b.group,mask:b.mask};k(this)}}]);return d}(),Ba=function(c){function b(a){y(this,b);a=R(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,U({type:"plane"},
N.rigidbody()),a));a.updateData(function(a,b){b=b.data;a.boundingBox||a.computeBoundingBox();b.width=a.boundingBox.max.x-a.boundingBox.min.x;b.height=a.boundingBox.max.y-a.boundingBox.min.y;b.normal=a.faces[0].normal.clone()});return a}O(b,c);return b}(N),Ca=function(c){function b(a){y(this,b);a=R(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,U({type:"sphere"},N.rigidbody()),a));a.updateData(function(a,b){b=b.data;a.boundingSphere||a.computeBoundingSphere();b.radius=a.boundingSphere.radius});
return a}O(b,c);return b}(N),Da=function(){function d(b){y(this,d);this.bridge={geometry:function(a,b){a instanceof c.BufferGeometry?b=a:(a.mergeVertices(),b=new c.BufferGeometry,b.addAttribute("position",(new c.BufferAttribute(new Float32Array(3*a.vertices.length),3)).copyVector3sArray(a.vertices)),b.setIndex((new c.BufferAttribute(new (65535<3*a.faces.length?Uint32Array:Uint16Array)(3*a.faces.length),1)).copyIndicesArray(a.faces)));var d=b.index.array;this._physijs.aVertices=b.attributes.position.array;
this._physijs.aIndices=d;return(new c.BufferGeometry).fromGeometry(a)},onCopy:n,onWrap:C};this.params=Object.assign({restitution:.3,friction:.8,damping:0,scale:new c.Vector3(1,1,1),pressure:100,margin:0,klst:.9,kvst:.9,kast:.9,piterations:1,viterations:0,diterations:0,citerations:4,anchorHardness:.7,rigidHardness:1},b)}G(d,[{key:"appendAnchor",value:function(b,a,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:!0,f=this._physijs.id,h=b._physijs.id;this.manager.has("module:world")&&
this.manager.get("module:world").execute("appendAnchor",{obj:f,obj2:h,node:a,influence:c,collisionBetweenLinkedBodies:d})}},{key:"integrate",value:function(b){var a=b.params;this._physijs={type:"softTrimesh",mass:a.mass,scale:a.scale,touches:[],friction:a.friction,damping:a.damping,pressure:a.pressure,margin:a.margin,klst:a.klst,isSoftbody:!0,kast:a.kast,kvst:a.kvst,drag:a.drag,lift:a.lift,piterations:a.piterations,viterations:a.viterations,diterations:a.diterations,citerations:a.citerations,anchorHardness:a.anchorHardness,
rigidHardness:a.rigidHardness};this.appendAnchor=b.appendAnchor.bind(this);k(this)}}]);return d}(),Ea=function(){function d(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};y(this,d);this.bridge={geometry:function(a,b){b=a.parameters;if(a instanceof c.BufferGeometry)var d=a;else{a.mergeVertices();d=new c.BufferGeometry;d.addAttribute("position",(new c.BufferAttribute(new Float32Array(3*a.vertices.length),3)).copyVector3sArray(a.vertices));a=a.faces;for(var f=a.length,h=new Float32Array(3*
f),l=0;l<f;l++){var k=3*l,n=a[l].normal||new c.Vector3;h[k]=n.x;h[k+1]=n.y;h[k+2]=n.z}d.addAttribute("normal",new c.BufferAttribute(h,3));d.setIndex((new c.BufferAttribute(new (65535<3*f?Uint32Array:Uint16Array)(3*f),1)).copyIndicesArray(a))}a=d.attributes.position.array;b.widthSegments||(b.widthSegments=1);b.heightSegments||(b.heightSegments=1);f=b.widthSegments;h=(b.heightSegments+1)*(b.widthSegments+1)-(b.widthSegments+1);l=a.length/3-1;this._physijs.corners=[a[3*f],a[3*f+1],a[3*f+2],a[0],a[1],
a[2],a[3*l],a[3*l+1],a[3*l+2],a[3*h],a[3*h+1],a[3*h+2]];this._physijs.segments=[b.widthSegments+1,b.heightSegments+1];return d},onCopy:n,onWrap:C};this.params=Object.assign({friction:.8,damping:0,margin:0,scale:new c.Vector3(1,1,1),klst:.9,kvst:.9,kast:.9,piterations:1,viterations:0,diterations:0,citerations:4,anchorHardness:.7,rigidHardness:1},b)}G(d,[{key:"appendAnchor",value:function(b,a,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:!0,f=this._physijs.id,h=b._physijs.id;this.manager.has("module:world")&&
this.manager.get("module:world").execute("appendAnchor",{obj:f,obj2:h,node:a,influence:c,collisionBetweenLinkedBodies:d})}},{key:"integrate",value:function(b){var a=b.params,c={type:"softClothMesh",mass:a.mass,touches:[],isSoftbody:!0,scale:a.scale,friction:a.friction,damping:a.damping,margin:a.margin,klst:a.klst,kast:a.kast,kvst:a.kvst,drag:a.drag,lift:a.lift,piterations:a.piterations,viterations:a.viterations,diterations:a.diterations,citerations:a.citerations,anchorHardness:a.anchorHardness,rigidHardness:a.rigidHardness};
a=a.scale;"scale"in c?Object.defineProperty(c,"scale",{value:a,enumerable:!0,configurable:!0,writable:!0}):c.scale=a;this._physijs=c;this.appendAnchor=b.appendAnchor.bind(this);k(this)}}]);return d}(),Fa=function(){function d(b){y(this,d);this.bridge={geometry:function(a){a instanceof c.BufferGeometry||(a=function(){var b=new c.BufferGeometry;b.addAttribute("position",(new c.BufferAttribute(new Float32Array(3*a.vertices.length),3)).copyVector3sArray(a.vertices));return b}());var b=a.attributes.position.array.length/
3,d=function(b){return(new c.Vector3).fromArray(a.attributes.position.array,3*b)},l=d(0);d=d(b-1);this._physijs.data=[l.x,l.y,l.z,d.x,d.y,d.z,b];return a},onCopy:n,onWrap:C};this.params=Object.assign({friction:.8,damping:0,margin:0,klst:.9,kvst:.9,kast:.9,piterations:1,viterations:0,diterations:0,citerations:4,anchorHardness:.7,rigidHardness:1},b)}G(d,[{key:"appendAnchor",value:function(b,a,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:!0,f=this._physijs.id,h=b._physijs.id;this.manager.has("module:world")&&
this.manager.get("module:world").execute("appendAnchor",{obj:f,obj2:h,node:a,influence:c,collisionBetweenLinkedBodies:d})}},{key:"integrate",value:function(b){var a=b.params;this._physijs={type:"softRopeMesh",mass:a.mass,touches:[],friction:a.friction,damping:a.damping,margin:a.margin,klst:a.klst,isSoftbody:!0,kast:a.kast,kvst:a.kvst,drag:a.drag,lift:a.lift,piterations:a.piterations,viterations:a.viterations,diterations:a.diterations,citerations:a.citerations,anchorHardness:a.anchorHardness,rigidHardness:a.rigidHardness};
this.appendAnchor=b.appendAnchor.bind(this);k(this)}}]);return d}(),na,oa,ia=Math.PI/2,Ga=(oa=na=function(){function c(b){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};y(this,c);this.object=b;this.params=a;this.params.block||(this.params.block=document.getElementById("blocker"))}G(c,[{key:"manager",value:function(b){var a=this;this.controls=new pa(b.get("camera"),this.object,this.params);if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in
document){var c=document.body,d=function(){document.pointerLockElement===c||document.mozPointerLockElement===c||document.webkitPointerLockElement===c?(a.controls.enabled=!0,a.params.block.style.display="none"):(a.controls.enabled=!1,a.params.block.style.display="block")};document.addEventListener("pointerlockchange",d,!1);document.addEventListener("mozpointerlockchange",d,!1);document.addEventListener("webkitpointerlockchange",d,!1);d=function(){console.warn("Pointer lock error.")};document.addEventListener("pointerlockerror",
d,!1);document.addEventListener("mozpointerlockerror",d,!1);document.addEventListener("webkitpointerlockerror",d,!1);document.querySelector("body").addEventListener("click",function(){c.requestPointerLock=c.requestPointerLock||c.mozRequestPointerLock||c.webkitRequestPointerLock;c.requestFullscreen=c.requestFullscreen||c.mozRequestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullscreen;if(/Firefox/i.test(navigator.userAgent)){var a=function K(){if(document.fullscreenElement===c||document.mozFullscreenElement===
c||document.mozFullScreenElement===c)document.removeEventListener("fullscreenchange",K),document.removeEventListener("mozfullscreenchange",K),c.requestPointerLock()};document.addEventListener("fullscreenchange",a,!1);document.addEventListener("mozfullscreenchange",a,!1);c.requestFullscreen()}else c.requestPointerLock()})}else console.warn("Your browser does not support the PointerLock WHS.API.");b.get("scene").add(this.controls.getObject())}},{key:"integrate",value:function(b){b.updateLoop=(new q.Loop(function(a){b.controls.update(a.getDelta())})).start(this)}}]);
return c}(),na.defaults={block:null,speed:1,ypos:1},oa);d.getEulerXYZFromQuaternion=function(d,b,a,f){return new c.Vector3(Math.atan2(2*(d*f-b*a),f*f-d*d-b*b+a*a),Math.asin(2*(d*a+b*f)),Math.atan2(2*(a*f-d*b),f*f+d*d-b*b-a*a))};d.getQuatertionFromEuler=function(c,b,a){var d=Math.cos(b);b=Math.sin(b);var k=Math.cos(-a);a=Math.sin(-a);var l=Math.cos(c);c=Math.sin(c);var h=d*k,n=b*a;return{w:h*l-n*c,x:h*c+n*l,y:b*k*l+d*a*c,z:d*a*l-b*k*c}};d.convertWorldPositionToObject=J;d.addObjectChildren=ha;d.MESSAGE_TYPES=
w;d.REPORT_ITEMSIZE=14;d.COLLISIONREPORT_ITEMSIZE=5;d.VEHICLEREPORT_ITEMSIZE=9;d.CONSTRAINTREPORT_ITEMSIZE=6;d.temp1Vector3=u;d.temp2Vector3=ea;d.temp1Matrix4=Q;d.temp1Quat=V;d.Eventable=ka;d.ConeTwistConstraint=ra;d.HingeConstraint=sa;d.PointConstraint=ta;d.SliderConstraint=ua;d.DOFConstraint=va;d.WorldModule=Y;d.BoxModule=ca;d.CompoundModule=da;d.CapsuleModule=aa;d.ConcaveModule=ba;d.ConeModule=xa;d.ConvexModule=ya;d.CylinderModule=za;d.HeightfieldModule=Aa;d.PlaneModule=Ba;d.SphereModule=Ca;d.SoftbodyModule=
Da;d.ClothModule=Ea;d.RopeModule=Fa;d.FirstPersonModule=Ga;Object.defineProperty(d,"__esModule",{value:!0})});
