/*! Physics module "Ammonext" v0.1.1 */
!function(t){var e={};function o(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=t,o.c=e,o.i=function(t){return t},o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e){var o=self.webkitPostMessage||self.postMessage,i={WORLDREPORT:0,COLLISIONREPORT:1,VEHICLEREPORT:2,CONSTRAINTREPORT:3,SOFTREPORT:4},a=void 0,s=void 0,n=void 0,r=void 0,m=!1,c=0,d=0,l=0,p=0,u=0,b=0,f=void 0,g=void 0,v=void 0,_=void 0,y=void 0,h=void 0,x=void 0,w={},A=[],R=[],z=[],S={},T={},L={},C={},M={},O=void 0,Y=void 0,X=void 0,Z=void 0,k=void 0,I=void 0,P=14,E=5,F=9,V=6,B=new ArrayBuffer(1);o(B,[B]);var j=0===B.byteLength,D=function(t){return void 0!==T[t]?T[t]:null},W=function(t,e){T[t]=e},H=function(t){var e=void 0;switch(n.setIdentity(),t.type){case"compound":e=new Ammo.btCompoundShape;break;case"plane":var o="plane_"+t.normal.x+"_"+t.normal.y+"_"+t.normal.z;null===(e=D(o))&&(_.setX(t.normal.x),_.setY(t.normal.y),_.setZ(t.normal.z),e=new Ammo.btStaticPlaneShape(_,0),W(o,e));break;case"box":var i="box_"+t.width+"_"+t.height+"_"+t.depth;null===(e=D(i))&&(_.setX(t.width/2),_.setY(t.height/2),_.setZ(t.depth/2),e=new Ammo.btBoxShape(_),W(i,e));break;case"sphere":var a="sphere_"+t.radius;null===(e=D(a))&&(e=new Ammo.btSphereShape(t.radius),W(a,e));break;case"cylinder":var s="cylinder_"+t.width+"_"+t.height+"_"+t.depth;null===(e=D(s))&&(_.setX(t.width/2),_.setY(t.height/2),_.setZ(t.depth/2),e=new Ammo.btCylinderShape(_),W(s,e));break;case"capsule":var r="capsule_"+t.radius+"_"+t.height;null===(e=D(r))&&(e=new Ammo.btCapsuleShape(t.radius,t.height-2*t.radius),W(r,e));break;case"cone":var m="cone_"+t.radius+"_"+t.height;null===(e=D(m))&&(e=new Ammo.btConeShape(t.radius,t.height),W(m,e));break;case"concave":var c=new Ammo.btTriangleMesh;if(!t.data.length)return!1;for(var d=t.data,l=0;l<d.length/9;l++)_.setX(d[9*l]),_.setY(d[9*l+1]),_.setZ(d[9*l+2]),y.setX(d[9*l+3]),y.setY(d[9*l+4]),y.setZ(d[9*l+5]),h.setX(d[9*l+6]),h.setY(d[9*l+7]),h.setZ(d[9*l+8]),c.addTriangle(_,y,h,!1);e=new Ammo.btBvhTriangleMeshShape(c,!0,!0),C[t.id]=e;break;case"convex":e=new Ammo.btConvexHullShape;for(var p=t.data,u=0;u<p.length/3;u++)_.setX(p[3*u]),_.setY(p[3*u+1]),_.setZ(p[3*u+2]),e.addPoint(_);C[t.id]=e;break;case"heightfield":for(var b=t.xpts,f=t.ypts,g=t.points,v=Ammo._malloc(4*b*f),x=0,w=0,A=0;x<b;x++)for(var R=0;R<f;R++)Ammo.HEAPF32[v+A>>2]=g[w],w++,A+=4;e=new Ammo.btHeightfieldTerrainShape(t.xpts,t.ypts,v,1,-t.absMaxHeight,t.absMaxHeight,1,"PHY_FLOAT",!1),C[t.id]=e;break;default:return}return e},N=function(t){var e=void 0,o=new Ammo.btSoftBodyHelpers;switch(t.type){case"softTrimesh":if(!t.aVertices.length)return!1;e=o.CreateFromTriMesh(v.getWorldInfo(),t.aVertices,t.aIndices,t.aIndices.length/3,!1);break;case"softClothMesh":var i=t.corners;e=o.CreatePatch(v.getWorldInfo(),new Ammo.btVector3(i[0],i[1],i[2]),new Ammo.btVector3(i[3],i[4],i[5]),new Ammo.btVector3(i[6],i[7],i[8]),new Ammo.btVector3(i[9],i[10],i[11]),t.segments[0],t.segments[1],0,!0);break;case"softRopeMesh":var a=t.data;e=o.CreateRope(v.getWorldInfo(),new Ammo.btVector3(a[0],a[1],a[2]),new Ammo.btVector3(a[3],a[4],a[5]),a[6]-1,0);break;default:return}return e};w.init=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.wasmBuffer?(importScripts(t.ammo),self.Ammo=loadAmmoFromBinary(t.wasmBuffer),o({cmd:"ammoLoaded"}),w.makeWorld(t)):(importScripts(t.ammo),o({cmd:"ammoLoaded"}),w.makeWorld(t))},w.makeWorld=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n=new Ammo.btTransform,r=new Ammo.btTransform,_=new Ammo.btVector3(0,0,0),y=new Ammo.btVector3(0,0,0),h=new Ammo.btVector3(0,0,0),x=new Ammo.btQuaternion(0,0,0,0),O=t.reportsize||50,j?(Y=new Float32Array(2+O*P),Z=new Float32Array(2+O*E),k=new Float32Array(2+O*F),I=new Float32Array(2+O*V)):(Y=[],Z=[],k=[],I=[]),Y[0]=i.WORLDREPORT,Z[0]=i.COLLISIONREPORT,k[0]=i.VEHICLEREPORT,I[0]=i.CONSTRAINTREPORT;var e=t.softbody?new Ammo.btSoftBodyRigidBodyCollisionConfiguration:new Ammo.btDefaultCollisionConfiguration,a=new Ammo.btCollisionDispatcher(e),s=new Ammo.btSequentialImpulseConstraintSolver,c=void 0;switch(t.broadphase||(t.broadphase={type:"dynamic"}),t.broadphase.type){case"sweepprune":_.setX(t.broadphase.aabbmin.x),_.setY(t.broadphase.aabbmin.y),_.setZ(t.broadphase.aabbmin.z),y.setX(t.broadphase.aabbmax.x),y.setY(t.broadphase.aabbmax.y),y.setZ(t.broadphase.aabbmax.z),c=new Ammo.btAxisSweep3(_,y);break;case"dynamic":default:c=new Ammo.btDbvtBroadphase}v=t.softbody?new Ammo.btSoftRigidDynamicsWorld(a,c,s,e,new Ammo.btDefaultSoftBodySolver):new Ammo.btDiscreteDynamicsWorld(a,c,s,e),f=t.fixedTimeStep,t.softbody&&(m=!0),o({cmd:"worldReady"})},w.setFixedTimeStep=function(t){f=t},w.setGravity=function(t){_.setX(t.x),_.setY(t.y),_.setZ(t.z),v.setGravity(_)},w.appendAnchor=function(t){A[t.obj].appendAnchor(t.node,A[t.obj2],t.collisionBetweenLinkedBodies,t.influence)},w.addObject=function(t){var e=void 0,i=void 0;if(t.type.indexOf("soft")!==-1){e=N(t);var a=e.get_m_cfg();t.viterations&&a.set_viterations(t.viterations),t.piterations&&a.set_piterations(t.piterations),t.diterations&&a.set_diterations(t.diterations),t.citerations&&a.set_citerations(t.citerations),a.set_collisions(17),a.set_kDF(t.friction),a.set_kDP(t.damping),t.pressure&&a.set_kPR(t.pressure),t.drag&&a.set_kDG(t.drag),t.lift&&a.set_kLF(t.lift),t.anchorHardness&&a.set_kAHR(t.anchorHardness),t.rigidHardness&&a.set_kCHR(t.rigidHardness),t.klst&&e.get_m_materials().at(0).set_m_kLST(t.klst),t.kast&&e.get_m_materials().at(0).set_m_kAST(t.kast),t.kvst&&e.get_m_materials().at(0).set_m_kVST(t.kvst),Ammo.castObject(e,Ammo.btCollisionObject).getCollisionShape().setMargin(t.margin?t.margin:.1),e.setActivationState(t.state||4),e.type=0,"softRopeMesh"===t.type&&(e.rope=!0),"softClothMesh"===t.type&&(e.cloth=!0),n.setIdentity(),_.setX(t.position.x),_.setY(t.position.y),_.setZ(t.position.z),n.setOrigin(_),x.setX(t.rotation.x),x.setY(t.rotation.y),x.setZ(t.rotation.z),x.setW(t.rotation.w),n.setRotation(x),e.transform(n),_.setX(t.scale.x),_.setY(t.scale.y),_.setZ(t.scale.z),e.scale(_),e.setTotalMass(t.mass,!1),v.addSoftBody(e,1,-1),b+="softTrimesh"===t.type?3*e.get_m_faces().size():"softRopeMesh"===t.type?e.get_m_nodes().size():3*e.get_m_nodes().size(),l++}else{var s=H(t);if(!s)return;if(t.children){var r=new Ammo.btCompoundShape;r.addChildShape(n,s);for(var m=0;m<t.children.length;m++){var p=t.children[m],u=new Ammo.btTransform;u.setIdentity(),_.setX(p.position_offset.x),_.setY(p.position_offset.y),_.setZ(p.position_offset.z),u.setOrigin(_),x.setX(p.rotation.x),x.setY(p.rotation.y),x.setZ(p.rotation.z),x.setW(p.rotation.w),u.setRotation(x),s=H(t.children[m]),r.addChildShape(u,s),Ammo.destroy(u)}s=r,M[t.id]=s}_.setX(t.scale.x),_.setY(t.scale.y),_.setZ(t.scale.z),s.setLocalScaling(_),s.setMargin(t.margin?t.margin:0),_.setX(0),_.setY(0),_.setZ(0),s.calculateLocalInertia(t.mass,_),n.setIdentity(),y.setX(t.position.x),y.setY(t.position.y),y.setZ(t.position.z),n.setOrigin(y),x.setX(t.rotation.x),x.setY(t.rotation.y),x.setZ(t.rotation.z),x.setW(t.rotation.w),n.setRotation(x),i=new Ammo.btDefaultMotionState(n);var f=new Ammo.btRigidBodyConstructionInfo(t.mass,i,s,_);f.set_m_friction(t.friction),f.set_m_restitution(t.restitution),f.set_m_linearDamping(t.damping),f.set_m_angularDamping(t.damping),e=new Ammo.btRigidBody(f),e.setActivationState(t.state||4),Ammo.destroy(f),"undefined"!=typeof t.collision_flags&&e.setCollisionFlags(t.collision_flags),t.group&&t.mask?v.addRigidBody(e,t.group,t.mask):v.addRigidBody(e),e.type=1,d++}e.activate(),e.id=t.id,A[e.id]=e,L[e.id]=i,S[void 0===e.a?e.ptr:e.a]=e.id,c++,o({cmd:"objectReady",params:e.id})},w.addVehicle=function(t){var e=new Ammo.btVehicleTuning;e.set_m_suspensionStiffness(t.suspension_stiffness),e.set_m_suspensionCompression(t.suspension_compression),e.set_m_suspensionDamping(t.suspension_damping),e.set_m_maxSuspensionTravelCm(t.max_suspension_travel),e.set_m_maxSuspensionForce(t.max_suspension_force);var o=new Ammo.btRaycastVehicle(e,A[t.rigidBody],new Ammo.btDefaultVehicleRaycaster(v));o.tuning=e,A[t.rigidBody].setActivationState(4),o.setCoordinateSystem(0,1,2),v.addVehicle(o),R[t.id]=o},w.removeVehicle=function(t){R[t.id]=null},w.addWheel=function(t){if(void 0!==R[t.id]){var e=R[t.id].tuning;void 0!==t.tuning&&(e=new Ammo.btVehicleTuning,e.set_m_suspensionStiffness(t.tuning.suspension_stiffness),e.set_m_suspensionCompression(t.tuning.suspension_compression),e.set_m_suspensionDamping(t.tuning.suspension_damping),e.set_m_maxSuspensionTravelCm(t.tuning.max_suspension_travel),e.set_m_maxSuspensionForce(t.tuning.max_suspension_force)),_.setX(t.connection_point.x),_.setY(t.connection_point.y),_.setZ(t.connection_point.z),y.setX(t.wheel_direction.x),y.setY(t.wheel_direction.y),y.setZ(t.wheel_direction.z),h.setX(t.wheel_axle.x),h.setY(t.wheel_axle.y),h.setZ(t.wheel_axle.z),R[t.id].addWheel(_,y,h,t.suspension_rest_length,t.wheel_radius,e,t.is_front_wheel)}p++,j?(k=new Float32Array(1+p*F),k[0]=i.VEHICLEREPORT):k=[i.VEHICLEREPORT]},w.setSteering=function(t){void 0!==R[t.id]&&R[t.id].setSteeringValue(t.steering,t.wheel)},w.setBrake=function(t){void 0!==R[t.id]&&R[t.id].setBrake(t.brake,t.wheel)},w.applyEngineForce=function(t){void 0!==R[t.id]&&R[t.id].applyEngineForce(t.force,t.wheel)},w.removeObject=function(t){0===A[t.id].type?(l--,b-=A[t.id].get_m_nodes().size(),v.removeSoftBody(A[t.id])):1===A[t.id].type&&(d--,v.removeRigidBody(A[t.id]),Ammo.destroy(L[t.id])),Ammo.destroy(A[t.id]),M[t.id]&&Ammo.destroy(M[t.id]),C[t.id]&&Ammo.destroy(C[t.id]),S[void 0===A[t.id].a?A[t.id].a:A[t.id].ptr]=null,A[t.id]=null,L[t.id]=null,M[t.id]&&(M[t.id]=null),C[t.id]&&(C[t.id]=null),c--},w.updateTransform=function(t){a=A[t.id],1===a.type?(a.getMotionState().getWorldTransform(n),t.pos&&(_.setX(t.pos.x),_.setY(t.pos.y),_.setZ(t.pos.z),n.setOrigin(_)),t.quat&&(x.setX(t.quat.x),x.setY(t.quat.y),x.setZ(t.quat.z),x.setW(t.quat.w),n.setRotation(x)),a.setWorldTransform(n),a.activate()):0===a.type&&(t.pos&&(_.setX(t.pos.x),_.setY(t.pos.y),_.setZ(t.pos.z),n.setOrigin(_)),t.quat&&(x.setX(t.quat.x),x.setY(t.quat.y),x.setZ(t.quat.z),x.setW(t.quat.w),n.setRotation(x)),a.transform(n))},w.updateMass=function(t){a=A[t.id],v.removeRigidBody(a),_.setX(0),_.setY(0),_.setZ(0),a.setMassProps(t.mass,_),v.addRigidBody(a),a.activate()},w.applyCentralImpulse=function(t){_.setX(t.x),_.setY(t.y),_.setZ(t.z),A[t.id].applyCentralImpulse(_),A[t.id].activate()},w.applyImpulse=function(t){_.setX(t.impulse_x),_.setY(t.impulse_y),_.setZ(t.impulse_z),y.setX(t.x),y.setY(t.y),y.setZ(t.z),A[t.id].applyImpulse(_,y),A[t.id].activate()},w.applyTorque=function(t){_.setX(t.torque_x),_.setY(t.torque_y),_.setZ(t.torque_z),A[t.id].applyTorque(_),A[t.id].activate()},w.applyCentralForce=function(t){_.setX(t.x),_.setY(t.y),_.setZ(t.z),A[t.id].applyCentralForce(_),A[t.id].activate()},w.applyForce=function(t){_.setX(t.force_x),_.setY(t.force_y),_.setZ(t.force_z),y.setX(t.x),y.setY(t.y),y.setZ(t.z),A[t.id].applyForce(_,y),A[t.id].activate()},w.onSimulationResume=function(){g=Date.now()},w.setAngularVelocity=function(t){_.setX(t.x),_.setY(t.y),_.setZ(t.z),A[t.id].setAngularVelocity(_),A[t.id].activate()},w.setLinearVelocity=function(t){_.setX(t.x),_.setY(t.y),_.setZ(t.z),A[t.id].setLinearVelocity(_),A[t.id].activate()},w.setAngularFactor=function(t){_.setX(t.x),_.setY(t.y),_.setZ(t.z),A[t.id].setAngularFactor(_)},w.setLinearFactor=function(t){_.setX(t.x),_.setY(t.y),_.setZ(t.z),A[t.id].setLinearFactor(_)},w.setDamping=function(t){A[t.id].setDamping(t.linear,t.angular)},w.setCcdMotionThreshold=function(t){A[t.id].setCcdMotionThreshold(t.threshold)},w.setCcdSweptSphereRadius=function(t){A[t.id].setCcdSweptSphereRadius(t.radius)},w.addConstraint=function(t){var e=void 0;switch(t.type){case"point":void 0===t.objectb?(_.setX(t.positiona.x),_.setY(t.positiona.y),_.setZ(t.positiona.z),e=new Ammo.btPoint2PointConstraint(A[t.objecta],_)):(_.setX(t.positiona.x),_.setY(t.positiona.y),_.setZ(t.positiona.z),y.setX(t.positionb.x),y.setY(t.positionb.y),y.setZ(t.positionb.z),e=new Ammo.btPoint2PointConstraint(A[t.objecta],A[t.objectb],_,y));break;case"hinge":void 0===t.objectb?(_.setX(t.positiona.x),_.setY(t.positiona.y),_.setZ(t.positiona.z),y.setX(t.axis.x),y.setY(t.axis.y),y.setZ(t.axis.z),e=new Ammo.btHingeConstraint(A[t.objecta],_,y)):(_.setX(t.positiona.x),_.setY(t.positiona.y),_.setZ(t.positiona.z),y.setX(t.positionb.x),y.setY(t.positionb.y),y.setZ(t.positionb.z),h.setX(t.axis.x),h.setY(t.axis.y),h.setZ(t.axis.z),e=new Ammo.btHingeConstraint(A[t.objecta],A[t.objectb],_,y,h,h));break;case"slider":var o=void 0,a=new Ammo.btTransform;_.setX(t.positiona.x),_.setY(t.positiona.y),_.setZ(t.positiona.z),a.setOrigin(_);var s=a.getRotation();s.setEuler(t.axis.x,t.axis.y,t.axis.z),a.setRotation(s),t.objectb?(o=new Ammo.btTransform,y.setX(t.positionb.x),y.setY(t.positionb.y),y.setZ(t.positionb.z),o.setOrigin(y),s=o.getRotation(),s.setEuler(t.axis.x,t.axis.y,t.axis.z),o.setRotation(s),e=new Ammo.btSliderConstraint(A[t.objecta],A[t.objectb],a,o,!0)):e=new Ammo.btSliderConstraint(A[t.objecta],a,!0),e.ta=a,e.tb=o,Ammo.destroy(a),void 0!==o&&Ammo.destroy(o);break;case"conetwist":var n=new Ammo.btTransform;n.setIdentity();var r=new Ammo.btTransform;r.setIdentity(),_.setX(t.positiona.x),_.setY(t.positiona.y),_.setZ(t.positiona.z),y.setX(t.positionb.x),y.setY(t.positionb.y),y.setZ(t.positionb.z),n.setOrigin(_),r.setOrigin(y);var m=n.getRotation();m.setEulerZYX(-t.axisa.z,-t.axisa.y,-t.axisa.x),n.setRotation(m),m=r.getRotation(),m.setEulerZYX(-t.axisb.z,-t.axisb.y,-t.axisb.x),r.setRotation(m),e=new Ammo.btConeTwistConstraint(A[t.objecta],A[t.objectb],n,r),e.setLimit(Math.PI,0,Math.PI),e.ta=n,e.tb=r,Ammo.destroy(n),Ammo.destroy(r);break;case"dof":var c=void 0,d=new Ammo.btTransform;d.setIdentity(),_.setX(t.positiona.x),_.setY(t.positiona.y),_.setZ(t.positiona.z),d.setOrigin(_);var l=d.getRotation();l.setEulerZYX(-t.axisa.z,-t.axisa.y,-t.axisa.x),d.setRotation(l),t.objectb?(c=new Ammo.btTransform,c.setIdentity(),y.setX(t.positionb.x),y.setY(t.positionb.y),y.setZ(t.positionb.z),c.setOrigin(y),l=c.getRotation(),l.setEulerZYX(-t.axisb.z,-t.axisb.y,-t.axisb.x),c.setRotation(l),e=new Ammo.btGeneric6DofConstraint(A[t.objecta],A[t.objectb],d,c,!0)):e=new Ammo.btGeneric6DofConstraint(A[t.objecta],d,!0),e.ta=d,e.tb=c,Ammo.destroy(d),void 0!==c&&Ammo.destroy(c);break;default:return}v.addConstraint(e),e.a=A[t.objecta],e.b=A[t.objectb],e.enableFeedback(),z[t.id]=e,u++,j?(I=new Float32Array(1+u*V),I[0]=i.CONSTRAINTREPORT):I=[i.CONSTRAINTREPORT]},w.removeConstraint=function(t){var e=z[t.id];void 0!==e&&(v.removeConstraint(e),z[t.id]=null,u--)},w.constraint_setBreakingImpulseThreshold=function(t){var e=z[t.id];e!==undefind&&e.setBreakingImpulseThreshold(t.threshold)},w.simulate=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v&&(t.timeStep&&t.timeStep<f&&(t.timeStep=f),t.maxSubSteps=t.maxSubSteps||Math.ceil(t.timeStep/f),v.stepSimulation(t.timeStep,t.maxSubSteps,f),R.length>0&&Q(),G(),z.length>0&&J(),q(),m&&U())},w.hinge_setLimits=function(t){z[t.constraint].setLimit(t.low,t.high,0,t.bias_factor,t.relaxation_factor)},w.hinge_enableAngularMotor=function(t){var e=z[t.constraint];e.enableAngularMotor(!0,t.velocity,t.acceleration),e.a.activate(),e.b&&e.b.activate()},w.hinge_disableMotor=function(t){z[t.constraint].enableMotor(!1),constraint.b&&constraint.b.activate()},w.slider_setLimits=function(t){var e=z[t.constraint];e.setLowerLinLimit(t.lin_lower||0),e.setUpperLinLimit(t.lin_upper||0),e.setLowerAngLimit(t.ang_lower||0),e.setUpperAngLimit(t.ang_upper||0)},w.slider_setRestitution=function(t){var e=z[t.constraint];e.setSoftnessLimLin(t.linear||0),e.setSoftnessLimAng(t.angular||0)},w.slider_enableLinearMotor=function(t){var e=z[t.constraint];e.setTargetLinMotorVelocity(t.velocity),e.setMaxLinMotorForce(t.acceleration),e.setPoweredLinMotor(!0),e.a.activate(),e.b&&e.b.activate()},w.slider_disableLinearMotor=function(t){var e=z[t.constraint];e.setPoweredLinMotor(!1),e.b&&e.b.activate()},w.slider_enableAngularMotor=function(t){var e=z[t.constraint];e.setTargetAngMotorVelocity(t.velocity),e.setMaxAngMotorForce(t.acceleration),e.setPoweredAngMotor(!0),e.a.activate(),e.b&&e.b.activate()},w.slider_disableAngularMotor=function(t){var e=z[t.constraint];e.setPoweredAngMotor(!1),e.a.activate(),e.b&&e.b.activate()},w.conetwist_setLimit=function(t){z[t.constraint].setLimit(t.z,t.y,t.x)},w.conetwist_enableMotor=function(t){var e=z[t.constraint];e.enableMotor(!0),e.a.activate(),e.b.activate()},w.conetwist_setMaxMotorImpulse=function(t){var e=z[t.constraint];e.setMaxMotorImpulse(t.max_impulse),e.a.activate(),e.b.activate()},w.conetwist_setMotorTarget=function(t){var e=z[t.constraint];x.setX(t.x),x.setY(t.y),x.setZ(t.z),x.setW(t.w),e.setMotorTarget(x),e.a.activate(),e.b.activate()},w.conetwist_disableMotor=function(t){var e=z[t.constraint];e.enableMotor(!1),e.a.activate(),e.b.activate()},w.dof_setLinearLowerLimit=function(t){var e=z[t.constraint];_.setX(t.x),_.setY(t.y),_.setZ(t.z),e.setLinearLowerLimit(_),e.a.activate(),e.b&&e.b.activate()},w.dof_setLinearUpperLimit=function(t){var e=z[t.constraint];_.setX(t.x),_.setY(t.y),_.setZ(t.z),e.setLinearUpperLimit(_),e.a.activate(),e.b&&e.b.activate()},w.dof_setAngularLowerLimit=function(t){var e=z[t.constraint];_.setX(t.x),_.setY(t.y),_.setZ(t.z),e.setAngularLowerLimit(_),e.a.activate(),e.b&&e.b.activate()},w.dof_setAngularUpperLimit=function(t){var e=z[t.constraint];_.setX(t.x),_.setY(t.y),_.setZ(t.z),e.setAngularUpperLimit(_),e.a.activate(),e.b&&e.b.activate()},w.dof_enableAngularMotor=function(t){var e=z[t.constraint],o=e.getRotationalLimitMotor(t.which);o.set_m_enableMotor(!0),e.a.activate(),e.b&&e.b.activate()},w.dof_configureAngularMotor=function(t){var e=z[t.constraint],o=e.getRotationalLimitMotor(t.which);o.set_m_loLimit(t.low_angle),o.set_m_hiLimit(t.high_angle),o.set_m_targetVelocity(t.velocity),o.set_m_maxMotorForce(t.max_force),e.a.activate(),e.b&&e.b.activate()},w.dof_disableAngularMotor=function(t){var e=z[t.constraint],o=e.getRotationalLimitMotor(t.which);o.set_m_enableMotor(!1),e.a.activate(),e.b&&e.b.activate()};var q=function(){j&&Y.length<2+d*P&&(Y=new Float32Array(2+Math.ceil(d/O)*O*P),Y[0]=i.WORLDREPORT),Y[1]=d;for(var t=0,e=A.length;e--;){var a=A[e];if(a&&1===a.type){var n=a.getCenterOfMassTransform(),r=n.getOrigin(),m=n.getRotation(),c=2+t++*P;Y[c]=a.id,Y[c+1]=r.x(),Y[c+2]=r.y(),Y[c+3]=r.z(),Y[c+4]=m.x(),Y[c+5]=m.y(),Y[c+6]=m.z(),Y[c+7]=m.w(),s=a.getLinearVelocity(),Y[c+8]=s.x(),Y[c+9]=s.y(),Y[c+10]=s.z(),s=a.getAngularVelocity(),Y[c+11]=s.x(),Y[c+12]=s.y(),Y[c+13]=s.z()}}j?o(Y.buffer,[Y.buffer]):o(Y)},U=function(){X=new Float32Array(2+2*l+6*b),X[0]=i.SOFTREPORT,X[1]=l;for(var t=2,e=A.length;e--;){var a=A[e];if(a&&0===a.type){X[t]=a.id;var s=t+2;if(a.rope===!0){var n=a.get_m_nodes(),r=n.size();X[t+1]=r;for(var m=0;m<r;m++){var c=n.at(m),d=c.get_m_x(),p=s+3*m;X[p]=d.x(),X[p+1]=d.y(),X[p+2]=d.z()}t+=3*r+2}else if(a.cloth){var u=a.get_m_nodes(),f=u.size();X[t+1]=f;for(var g=0;g<f;g++){var v=u.at(g),_=v.get_m_x(),y=v.get_m_n(),h=s+6*g;X[h]=_.x(),X[h+1]=_.y(),X[h+2]=_.z(),X[h+3]=y.x(),X[h+4]=y.y(),X[h+5]=y.z()}t+=6*f+2}else{var x=a.get_m_faces(),w=x.size();X[t+1]=w;for(var R=0;R<w;R++){var z=x.at(R),S=z.get_m_n(0),T=z.get_m_n(1),L=z.get_m_n(2),C=S.get_m_x(),M=T.get_m_x(),O=L.get_m_x(),Y=S.get_m_n(),Z=T.get_m_n(),k=L.get_m_n(),I=s+18*R;X[I]=C.x(),X[I+1]=C.y(),X[I+2]=C.z(),X[I+3]=Y.x(),X[I+4]=Y.y(),X[I+5]=Y.z(),X[I+6]=M.x(),X[I+7]=M.y(),X[I+8]=M.z(),X[I+9]=Z.x(),X[I+10]=Z.y(),X[I+11]=Z.z(),X[I+12]=O.x(),X[I+13]=O.y(),X[I+14]=O.z(),X[I+15]=k.x(),X[I+16]=k.y(),X[I+17]=k.z()}t+=18*w+2}}}o(X)},G=function(){var t=v.getDispatcher(),e=t.getNumManifolds();j&&Z.length<2+e*E&&(Z=new Float32Array(2+Math.ceil(c/O)*O*E),Z[0]=i.COLLISIONREPORT),Z[1]=0;for(var a=0;a<e;a++){var n=t.getManifoldByIndexInternal(a),r=n.getNumContacts();if(0!==r)for(var m=0;m<r;m++){var d=n.getContactPoint(m),l=2+Z[1]++*E;Z[l]=S[n.getBody0().ptr],Z[l+1]=S[n.getBody1().ptr],s=d.get_m_normalWorldOnB(),Z[l+2]=s.x(),Z[l+3]=s.y(),Z[l+4]=s.z();break}}j?o(Z.buffer,[Z.buffer]):o(Z)},Q=function(){j&&k.length<2+p*F&&(k=new Float32Array(2+Math.ceil(p/O)*O*F),k[0]=i.VEHICLEREPORT);for(var t=0,e=0,a=R.length;a--;)if(R[a]){var s=R[a];for(e=0;e<s.getNumWheels();e++){var n=s.getWheelInfo(e).get_m_worldTransform(),r=n.getOrigin(),m=n.getRotation(),c=1+t++*F;k[c]=a,k[c+1]=e,k[c+2]=r.x(),k[c+3]=r.y(),k[c+4]=r.z(),k[c+5]=m.x(),k[c+6]=m.y(),k[c+7]=m.z(),k[c+8]=m.w()}}j&&0!==e?o(k.buffer,[k.buffer]):0!==e&&o(k)},J=function(){j&&I.length<2+u*V&&(I=new Float32Array(2+Math.ceil(u/O)*O*V),I[0]=i.CONSTRAINTREPORT);for(var t=0,e=0,a=z.lenght;a--;)if(z[a]){var s=z[a],n=s.a,r=s.ta,m=r.getOrigin();t=1+e++*V,I[t]=a,I[t+1]=n.id,I[t+2]=m.x,I[t+3]=m.y,I[t+4]=m.z,I[t+5]=s.getBreakingImpulseThreshold()}j&&0!==e?o(I.buffer,[I.buffer]):0!==e&&o(I)};self.onmessage=function(t){if(t.data instanceof Float32Array)switch(t.data[0]){case i.WORLDREPORT:Y=new Float32Array(t.data);break;case i.COLLISIONREPORT:Z=new Float32Array(t.data);break;case i.VEHICLEREPORT:k=new Float32Array(t.data);break;case i.CONSTRAINTREPORT:I=new Float32Array(t.data)}else t.data.cmd&&w[t.data.cmd]&&w[t.data.cmd](t.data.params)}}]);